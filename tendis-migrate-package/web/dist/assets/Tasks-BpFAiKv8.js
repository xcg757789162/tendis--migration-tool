import{_ as J,o as O,a as Q,b as r,c as p,d as n,e as a,w as l,f as _,t as d,l as B,h as W,n as X,g as z,m as Z,i as f,j as o,k,p as ee,q as te,E as i,s as se,u as ae}from"./index-aaIhUkFC.js";const le={class:"tasks-page"},ne={class:"page-header"},oe={class:"filter-bar"},re={class:"tasks-list"},ie={class:"task-name-cell"},ce={class:"name"},de=["onClick"],ue={key:0,class:"progress-cell"},pe={class:"progress-bar"},_e={class:"progress-text"},me={key:1,class:"no-progress"},ge={key:0},ke={key:1},fe={key:0},ve={key:1},ye={class:"pagination"},he={__name:"Tasks",setup(be){const S=ae(),V=k([]),$=k(0),h=k(1),b=k(20),v=k(""),C=k("");let T=null;const M=se(()=>{let t=V.value;return v.value&&(t=t.filter(s=>s.name.toLowerCase().includes(v.value.toLowerCase()))),t}),c=async()=>{try{const t=await f.getTasks({page:h.value,size:b.value,status:C.value});V.value=t.items||[],$.value=t.total||0}catch(t){console.error("Fetch tasks failed:",t)}},F=async t=>{try{await f.startTask(t),i.success("任务已启动"),c()}catch{i.error("启动失败")}},D=async t=>{try{await f.pauseTask(t),i.success("任务已暂停"),c()}catch{i.error("暂停失败")}},I=async t=>{try{await f.resumeTask(t),i.success("任务已恢复"),c()}catch{i.error("恢复失败")}},N=async t=>{try{await te.confirm(`确定要删除任务 "${t.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await f.deleteTask(t.id),i.success("任务已删除"),c()}catch(s){s!=="cancel"&&i.error("删除失败")}},R=t=>{S.push(`/tasks/${t.id}`)},U=t=>({pending:"待启动",running:"运行中",paused:"已暂停",completed:"已完成",failed:"失败"})[t]||t,E=({row:t})=>`row-${t.status}`,x=t=>t>=1e9?(t/1e9).toFixed(1)+"B":t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString(),Y=t=>ee(t).format("YYYY-MM-DD HH:mm:ss"),P=async t=>{try{await navigator.clipboard.writeText(t),i.success("任务ID已复制")}catch{i.error("复制失败")}};return O(()=>{c(),T=setInterval(c,1e4)}),Q(()=>{T&&clearInterval(T)}),(t,s)=>{const j=o("Plus"),w=o("el-icon"),m=o("el-button"),H=o("el-input"),g=o("el-option"),L=o("el-select"),q=o("Refresh"),K=o("el-tooltip"),u=o("el-table-column"),A=o("el-table"),G=o("el-pagination");return r(),p("div",le,[n("div",ne,[s[7]||(s[7]=n("div",null,[n("h1",null,"迁移任务"),n("p",null,"管理所有数据迁移任务")],-1)),a(m,{type:"primary",onClick:s[0]||(s[0]=e=>t.$router.push("/create"))},{default:l(()=>[a(w,null,{default:l(()=>[a(j)]),_:1}),s[6]||(s[6]=_(" 创建任务 ",-1))]),_:1})]),n("div",oe,[a(H,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),placeholder:"搜索任务名称...","prefix-icon":"Search",clearable:"",style:{width:"280px"}},null,8,["modelValue"]),a(L,{modelValue:C.value,"onUpdate:modelValue":s[2]||(s[2]=e=>C.value=e),placeholder:"全部状态",clearable:"",style:{width:"140px"}},{default:l(()=>[a(g,{label:"全部",value:""}),a(g,{label:"待启动",value:"pending"}),a(g,{label:"运行中",value:"running"}),a(g,{label:"已暂停",value:"paused"}),a(g,{label:"已完成",value:"completed"}),a(g,{label:"失败",value:"failed"})]),_:1},8,["modelValue"]),a(m,{onClick:c},{default:l(()=>[a(w,null,{default:l(()=>[a(q)]),_:1}),s[8]||(s[8]=_(" 刷新 ",-1))]),_:1})]),n("div",re,[a(A,{data:M.value,style:{width:"100%"},"row-class-name":E,onRowClick:R},{default:l(()=>[a(u,{label:"任务名称","min-width":"200"},{default:l(({row:e})=>[n("div",ie,[n("span",ce,d(e.name),1),a(K,{content:e.id,placement:"top"},{default:l(()=>[n("span",{class:"id",onClick:B(y=>P(e.id),["stop"])},d(e.id),9,de)]),_:2},1032,["content"])])]),_:1}),a(u,{label:"状态",width:"120"},{default:l(({row:e})=>[n("span",{class:W(["status-tag",e.status])},d(U(e.status)),3)]),_:1}),a(u,{label:"进度","min-width":"200"},{default:l(({row:e})=>[e.progress?(r(),p("div",ue,[n("div",pe,[n("div",{class:"progress-inner",style:X({width:(e.progress.percentage||0)+"%"})},null,4)]),n("span",_e,d((e.progress.percentage||0).toFixed(1))+"%",1)])):(r(),p("span",me,"-"))]),_:1}),a(u,{label:"迁移数据",width:"160"},{default:l(({row:e})=>[e.progress?(r(),p("span",ge,d(x(e.progress.keys_migrated||e.progress.migrated_keys||0))+" / "+d(x(e.progress.keys_total||e.progress.total_keys||0)),1)):(r(),p("span",ke,"-"))]),_:1}),a(u,{label:"速度",width:"120"},{default:l(({row:e})=>[e.progress&&(e.progress.speed||e.progress.current_speed)?(r(),p("span",fe,d(x(e.progress.speed||e.progress.current_speed))+"/s ",1)):(r(),p("span",ve,"-"))]),_:1}),a(u,{label:"创建时间",width:"180"},{default:l(({row:e})=>[_(d(Y(e.created_at)),1)]),_:1}),a(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:e})=>[n("div",{class:"actions",onClick:s[3]||(s[3]=B(()=>{},["stop"]))},[e.status==="pending"?(r(),z(m,{key:0,size:"small",type:"primary",onClick:y=>F(e.id)},{default:l(()=>[...s[9]||(s[9]=[_("启动",-1)])]),_:1},8,["onClick"])):e.status==="running"?(r(),z(m,{key:1,size:"small",onClick:y=>D(e.id)},{default:l(()=>[...s[10]||(s[10]=[_("暂停",-1)])]),_:1},8,["onClick"])):e.status==="paused"?(r(),z(m,{key:2,size:"small",type:"primary",onClick:y=>I(e.id)},{default:l(()=>[...s[11]||(s[11]=[_("恢复",-1)])]),_:1},8,["onClick"])):Z("",!0),a(m,{size:"small",type:"danger",onClick:y=>N(e)},{default:l(()=>[...s[12]||(s[12]=[_("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),n("div",ye,[a(G,{"current-page":h.value,"onUpdate:currentPage":s[4]||(s[4]=e=>h.value=e),"page-size":b.value,"onUpdate:pageSize":s[5]||(s[5]=e=>b.value=e),total:$.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])])])}}},Te=J(he,[["__scopeId","data-v-e8cd355d"]]);export{Te as default};
