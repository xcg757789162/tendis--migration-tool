import{_ as Qe,b as f,c as k,d as o,e as l,w as t,f as r,F as P,r as L,g as A,z as be,h as Ve,t as _,p as U,A as se,B as xe,C as Ge,j as i,y as Ce,k as g,E as V,i as S,D as Ze,s as He,u as Je}from"./index-DfwV5RE1.js";const Xe={class:"create-task"},Ye={class:"page-header"},he={class:"form-container card"},el={class:"form-section"},ll={class:"form-section"},tl={class:"addrs-input"},sl={key:0},ol={key:0,class:"cluster-info"},nl={class:"info-row"},al={class:"info-row"},rl={class:"info-row"},il={class:"info-row"},dl={class:"info-row"},ul={class:"form-section"},pl={class:"addrs-input"},ml={key:0},_l={key:0,class:"cluster-info"},fl={class:"info-row"},cl={class:"info-row"},vl={class:"info-row"},gl={class:"info-row"},yl={class:"info-row"},wl={class:"form-section"},kl={key:0,class:"filter-options"},bl={class:"prefix-input"},Vl={class:"prefix-input"},xl={key:1,class:"filter-options"},Cl={class:"prefix-input"},Ul={class:"form-section"},$l={key:0,class:"recommend-result"},Tl={class:"recommend-info"},Bl={class:"recommend-row"},Kl={class:"value highlight"},zl={class:"recommend-row"},Al={class:"value highlight"},ql={class:"recommend-row"},Dl={class:"value"},Sl={class:"recommend-row"},Fl={class:"value"},Rl={class:"recommend-row"},Ml={class:"value reason"},Pl={class:"advanced-options"},Ll={class:"rate-limit-section"},Nl={class:"retry-config-section"},El={class:"form-actions"},Wl={class:"left-actions"},Ol={class:"right-actions"},jl={key:0,class:"empty-templates"},Il={__name:"CreateTask",setup(Ql){const oe=Je(),ne=g(),F=g(!1),Z=g(!1),N=g(""),E=g(""),W=g(""),H=g(!1),J=g(!1),y=g(null),w=g(null),X=g(!1),x=g(null),R=g(!1),O=g(!1),Y=g(!1),j=g(!1),h=g([]),$=Ce({name:"",description:""}),s=Ce({name:"",migration_mode:"full_and_incremental",source_addrs:[""],source_password:"",target_addrs:[""],target_password:"",options:{worker_count:4,scan_batch_size:1e3,enable_compression:!0,large_key_threshold:10485760,conflict_policy:"skip_full_only",skip_full_sync:!1,skip_incremental:!1,key_filter:{mode:"all",prefixes:[],exclude_prefixes:[],patterns:[]},rate_limit:{source_qps:1e4,source_connections:50,target_qps:1e4,target_connections:50,pipeline_size:100,pipeline_timeout_ms:5e3,max_bandwidth_mbps:0},retry_config:{max_retries:3,full_retry_interval_ms:100,incr_retry_interval_ms:1e3}}}),Ue={name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],source_addrs:[{required:!0,message:"请输入源集群地址",trigger:"blur"}],target_addrs:[{required:!0,message:"请输入目标集群地址",trigger:"blur"}]},$e=n=>{n==="save"?($.name=s.name||"",$.description="",R.value=!0):n==="load"&&(ae(),O.value=!0)},ae=async()=>{j.value=!0;try{const n=await S.getTemplates();h.value=n.items||[]}catch(n){console.error("Failed to load templates:",n)}finally{j.value=!1}},Te=async()=>{if(!$.name.trim()){V.error("请输入模板名称");return}Y.value=!0;try{const n=s.source_addrs.filter(p=>p.trim()),e=s.target_addrs.filter(p=>p.trim());await S.createTemplate({name:$.name,description:$.description,source_cluster:{addrs:n,password:s.source_password},target_cluster:{addrs:e,password:s.target_password},migration_mode:s.migration_mode,options:s.options}),V.success("模板保存成功"),R.value=!1}catch(n){V.error("保存失败: "+(n.message||"未知错误"))}finally{Y.value=!1}},Be=n=>{n.source_cluster&&(s.source_addrs=n.source_cluster.split(",").filter(e=>e.trim()),s.source_addrs.length===0&&(s.source_addrs=[""]),s.source_password=n.source_password||""),n.target_cluster&&(s.target_addrs=n.target_cluster.split(",").filter(e=>e.trim()),s.target_addrs.length===0&&(s.target_addrs=[""]),s.target_password=n.target_password||""),s.migration_mode=n.migration_mode||"full_and_incremental",n.options&&(Object.assign(s.options,n.options),n.options.key_filter&&(s.options.key_filter={...n.options.key_filter}),n.options.rate_limit&&(s.options.rate_limit={...n.options.rate_limit}),n.options.retry_config&&(s.options.retry_config={...n.options.retry_config})),s.name=n.name+"-"+new Date().toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/[\/\s:]/g,""),O.value=!1,V.success("已加载模板配置")},Ke=n=>{He.confirm(`确定要删除模板 "${n.name}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await S.deleteTemplate(n.id),V.success("模板已删除"),ae()}catch{V.error("删除失败")}}).catch(()=>{})},ze=n=>n?new Date(n).toLocaleString("zh-CN"):"-",re=n=>{n==="source"?s.source_addrs.push(""):s.target_addrs.push("")},ie=(n,e)=>{n==="source"?s.source_addrs.splice(e,1):s.target_addrs.splice(e,1)},q=n=>{let e="";n==="prefixes"?(e=N.value.trim(),e&&!s.options.key_filter.prefixes.includes(e)&&s.options.key_filter.prefixes.push(e),N.value=""):n==="exclude_prefixes"?(e=E.value.trim(),e&&!s.options.key_filter.exclude_prefixes.includes(e)&&s.options.key_filter.exclude_prefixes.push(e),E.value=""):n==="patterns"&&(e=W.value.trim(),e&&!s.options.key_filter.patterns.includes(e)&&s.options.key_filter.patterns.push(e),W.value="")},ee=(n,e)=>{s.options.key_filter[n].splice(e,1)},de=async n=>{const e=n==="source"?s.source_addrs.filter(d=>d.trim()):s.target_addrs.filter(d=>d.trim()),p=n==="source"?s.source_password:s.target_password;if(e.length===0){V.warning("请先输入集群地址");return}n==="source"?(H.value=!0,y.value=null):(J.value=!0,w.value=null);try{const d=await S.testConnection({addrs:e,password:p});n==="source"?y.value=d:w.value=d}catch(d){const m={success:!1,message:"测试失败: "+(d.message||"未知错误")};n==="source"?y.value=m:w.value=m}finally{n==="source"?H.value=!1:J.value=!1}},Ae=async()=>{const n=s.source_addrs.filter(p=>p.trim()),e=s.target_addrs.filter(p=>p.trim());if(n.length===0||e.length===0){V.warning("请先完成源端和目标端连接测试");return}X.value=!0,x.value=null;try{const p=await S.getRecommendedConfig({source_cluster:{addrs:n,password:s.source_password},target_cluster:{addrs:e,password:s.target_password}});x.value=p.recommended,F.value=!0,V.success("推荐配置已生成")}catch(p){V.error("获取推荐配置失败: "+(p.message||"未知错误"))}finally{X.value=!1}},qe=()=>{if(!x.value)return;const n=x.value;s.options.worker_count=n.worker_count,s.options.scan_batch_size=n.scan_batch_size,s.options.rate_limit.source_qps=n.source_qps,s.options.rate_limit.target_qps=n.target_qps,s.options.rate_limit.source_connections=n.source_connections,s.options.rate_limit.target_connections=n.target_connections,n.large_key_threshold&&(s.options.large_key_threshold=n.large_key_threshold),V.success("推荐配置已应用")},le=n=>n==null?"-":n.toLocaleString(),ue=n=>{if(n==null||n===0)return"-";const e=["B","KB","MB","GB","TB"];let p=0;for(;n>=1024&&p<e.length-1;)n/=1024,p++;return n.toFixed(2)+" "+e[p]},De=async()=>{try{await ne.value.validate()}catch{return}const n=s.source_addrs.filter(p=>p.trim()),e=s.target_addrs.filter(p=>p.trim());if(n.length===0){V.error("请输入源集群地址");return}if(e.length===0){V.error("请输入目标集群地址");return}Z.value=!0;try{const p={name:s.name,migration_mode:s.migration_mode,source_cluster:{addrs:n,password:s.source_password},target_cluster:{addrs:e,password:s.target_password},options:{...s.options,skip_incremental:s.migration_mode==="full_only"}},d=await S.createTask(p);V.success("任务创建成功");const m=d.task_id||d.id;m?oe.push(`/tasks/${m}`):oe.push("/tasks")}catch(p){V.error("创建失败: "+(p.message||"未知错误"))}finally{Z.value=!1}};return(n,e)=>{const p=i("ArrowLeft"),d=i("el-icon"),m=i("el-button"),pe=i("Document"),T=i("el-input"),u=i("el-form-item"),me=i("el-radio"),Se=i("el-radio-group"),I=i("Connection"),_e=i("Delete"),fe=i("Plus"),D=i("el-tag"),Fe=i("Filter"),C=i("el-option"),te=i("el-select"),b=i("el-col"),z=i("el-row"),Re=i("Setting"),Q=i("el-switch"),Me=i("MagicStick"),ce=i("Check"),Pe=i("el-alert"),B=i("el-input-number"),Le=i("ArrowDown"),Ne=i("FolderAdd"),ve=i("el-dropdown-item"),Ee=i("FolderOpened"),We=i("el-dropdown-menu"),Oe=i("el-dropdown"),ge=i("el-form"),ye=i("el-dialog"),M=i("el-table-column"),je=i("el-table"),Ie=Ze("loading");return f(),k("div",Xe,[o("div",Ye,[l(m,{text:"",onClick:e[0]||(e[0]=c=>n.$router.push("/tasks"))},{default:t(()=>[l(d,null,{default:t(()=>[l(p)]),_:1}),e[40]||(e[40]=r(" 返回 ",-1))]),_:1}),e[41]||(e[41]=o("h1",null,"创建迁移任务",-1))]),o("div",he,[l(ge,{ref_key:"formRef",ref:ne,model:s,rules:Ue,"label-width":"140px","label-position":"top"},{default:t(()=>{var c,G,we,ke;return[o("div",el,[o("h3",null,[l(d,null,{default:t(()=>[l(pe)]),_:1}),e[42]||(e[42]=r(" 基本信息",-1))]),l(u,{label:"任务名称",prop:"name"},{default:t(()=>[l(T,{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=a=>s.name=a),placeholder:"请输入任务名称，如：生产环境数据迁移",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(u,{label:"迁移模式",prop:"migration_mode"},{default:t(()=>[l(Se,{modelValue:s.migration_mode,"onUpdate:modelValue":e[2]||(e[2]=a=>s.migration_mode=a)},{default:t(()=>[l(me,{value:"full_only"},{default:t(()=>[...e[43]||(e[43]=[o("span",{class:"mode-label"},"全量迁移",-1),o("span",{class:"mode-desc"},"仅执行全量数据迁移，适用于源端数据不再变化的场景",-1)])]),_:1}),l(me,{value:"full_and_incremental"},{default:t(()=>[...e[44]||(e[44]=[o("span",{class:"mode-label"},"全量+增量迁移",-1),o("span",{class:"mode-desc"},"先全量迁移，再持续同步增量数据，适用于在线迁移场景",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),o("div",ll,[o("h3",null,[l(d,null,{default:t(()=>[l(I)]),_:1}),e[45]||(e[45]=r(" 源集群配置",-1))]),l(u,{label:"集群地址",prop:"source_addrs"},{default:t(()=>[o("div",tl,[(f(!0),k(P,null,L(s.source_addrs,(a,v)=>(f(),A(T,{key:"source-"+v,modelValue:s.source_addrs[v],"onUpdate:modelValue":K=>s.source_addrs[v]=K,placeholder:"如: 127.0.0.1:6379"},be({_:2},[s.source_addrs.length>1?{name:"append",fn:t(()=>[l(m,{onClick:K=>ie("source",v)},{default:t(()=>[l(d,null,{default:t(()=>[l(_e)]),_:1})]),_:1},8,["onClick"])]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]))),128)),l(m,{text:"",type:"primary",onClick:e[3]||(e[3]=a=>re("source"))},{default:t(()=>[l(d,null,{default:t(()=>[l(fe)]),_:1}),e[46]||(e[46]=r(" 添加节点 ",-1))]),_:1})])]),_:1}),l(u,{label:"访问密码"},{default:t(()=>[l(T,{modelValue:s.source_password,"onUpdate:modelValue":e[4]||(e[4]=a=>s.source_password=a),type:"password",placeholder:"无密码可留空","show-password":""},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(m,{type:"success",plain:"",onClick:e[5]||(e[5]=a=>de("source")),loading:H.value},{default:t(()=>[l(d,null,{default:t(()=>[l(I)]),_:1}),e[47]||(e[47]=r(" 测试连接 ",-1))]),_:1},8,["loading"]),y.value?(f(),k("span",{key:0,class:Ve(["test-result",y.value.success?"success":"error"])},[r(_(y.value.message)+" ",1),y.value.latency_ms?(f(),k("span",sl,"("+_(y.value.latency_ms)+"ms)",1)):U("",!0)],2)):U("",!0)]),_:1}),(c=y.value)!=null&&c.cluster_info?(f(),k("div",ol,[o("div",nl,[e[48]||(e[48]=o("span",{class:"label"},"连接模式:",-1)),l(D,{type:y.value.cluster_info.mode==="cluster"?"success":"info",size:"small"},{default:t(()=>[r(_(y.value.cluster_info.mode==="cluster"?"集群模式":"单机模式"),1)]),_:1},8,["type"])]),o("div",al,[e[49]||(e[49]=o("span",{class:"label"},"Redis版本:",-1)),o("span",null,_(y.value.cluster_info.version),1)]),o("div",rl,[e[50]||(e[50]=o("span",{class:"label"},"节点数:",-1)),o("span",null,_(y.value.cluster_info.node_count),1)]),o("div",il,[e[51]||(e[51]=o("span",{class:"label"},"总Key数:",-1)),o("span",null,_(le(y.value.cluster_info.total_keys)),1)]),o("div",dl,[e[52]||(e[52]=o("span",{class:"label"},"内存使用:",-1)),o("span",null,_(ue(y.value.cluster_info.total_memory)),1)])])):U("",!0)]),o("div",ul,[o("h3",null,[l(d,null,{default:t(()=>[l(I)]),_:1}),e[53]||(e[53]=r(" 目标集群配置",-1))]),l(u,{label:"集群地址",prop:"target_addrs"},{default:t(()=>[o("div",pl,[(f(!0),k(P,null,L(s.target_addrs,(a,v)=>(f(),A(T,{key:"target-"+v,modelValue:s.target_addrs[v],"onUpdate:modelValue":K=>s.target_addrs[v]=K,placeholder:"如: 127.0.0.1:6379"},be({_:2},[s.target_addrs.length>1?{name:"append",fn:t(()=>[l(m,{onClick:K=>ie("target",v)},{default:t(()=>[l(d,null,{default:t(()=>[l(_e)]),_:1})]),_:1},8,["onClick"])]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]))),128)),l(m,{text:"",type:"primary",onClick:e[6]||(e[6]=a=>re("target"))},{default:t(()=>[l(d,null,{default:t(()=>[l(fe)]),_:1}),e[54]||(e[54]=r(" 添加节点 ",-1))]),_:1})])]),_:1}),l(u,{label:"访问密码"},{default:t(()=>[l(T,{modelValue:s.target_password,"onUpdate:modelValue":e[7]||(e[7]=a=>s.target_password=a),type:"password",placeholder:"无密码可留空","show-password":""},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(m,{type:"success",plain:"",onClick:e[8]||(e[8]=a=>de("target")),loading:J.value},{default:t(()=>[l(d,null,{default:t(()=>[l(I)]),_:1}),e[55]||(e[55]=r(" 测试连接 ",-1))]),_:1},8,["loading"]),w.value?(f(),k("span",{key:0,class:Ve(["test-result",w.value.success?"success":"error"])},[r(_(w.value.message)+" ",1),w.value.latency_ms?(f(),k("span",ml,"("+_(w.value.latency_ms)+"ms)",1)):U("",!0)],2)):U("",!0)]),_:1}),(G=w.value)!=null&&G.cluster_info?(f(),k("div",_l,[o("div",fl,[e[56]||(e[56]=o("span",{class:"label"},"连接模式:",-1)),l(D,{type:w.value.cluster_info.mode==="cluster"?"success":"info",size:"small"},{default:t(()=>[r(_(w.value.cluster_info.mode==="cluster"?"集群模式":"单机模式"),1)]),_:1},8,["type"])]),o("div",cl,[e[57]||(e[57]=o("span",{class:"label"},"Redis版本:",-1)),o("span",null,_(w.value.cluster_info.version),1)]),o("div",vl,[e[58]||(e[58]=o("span",{class:"label"},"节点数:",-1)),o("span",null,_(w.value.cluster_info.node_count),1)]),o("div",gl,[e[59]||(e[59]=o("span",{class:"label"},"总Key数:",-1)),o("span",null,_(le(w.value.cluster_info.total_keys)),1)]),o("div",yl,[e[60]||(e[60]=o("span",{class:"label"},"内存使用:",-1)),o("span",null,_(ue(w.value.cluster_info.total_memory)),1)])])):U("",!0)]),o("div",wl,[o("h3",null,[l(d,null,{default:t(()=>[l(Fe)]),_:1}),e[61]||(e[61]=r(" Key过滤配置",-1))]),l(z,{gutter:24},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"过滤模式"},{default:t(()=>[l(te,{modelValue:s.options.key_filter.mode,"onUpdate:modelValue":e[9]||(e[9]=a=>s.options.key_filter.mode=a),style:{width:"100%"}},{default:t(()=>[l(C,{label:"all - 迁移所有Key",value:"all"}),l(C,{label:"prefix - 按前缀迁移/排除",value:"prefix"}),l(C,{label:"pattern - 按正则匹配",value:"pattern"})]),_:1},8,["modelValue"]),e[62]||(e[62]=o("div",{class:"form-tip"},"选择如何筛选要迁移的Key",-1))]),_:1})]),_:1})]),_:1}),s.options.key_filter.mode==="prefix"?(f(),k("div",kl,[l(u,{label:"迁移前缀（只迁移这些前缀的Key，留空则迁移所有）"},{default:t(()=>[o("div",bl,[(f(!0),k(P,null,L(s.options.key_filter.prefixes,(a,v)=>(f(),A(D,{key:"prefix-"+v,closable:"",type:"success",onClose:K=>ee("prefixes",v),style:{"margin-right":"8px","margin-bottom":"8px"}},{default:t(()=>[r(_(a),1)]),_:2},1032,["onClose"]))),128)),l(T,{modelValue:N.value,"onUpdate:modelValue":e[11]||(e[11]=a=>N.value=a),placeholder:"输入前缀后按回车添加，如: user:",style:{width:"280px"},onKeyup:e[12]||(e[12]=se(a=>q("prefixes"),["enter"]))},{append:t(()=>[l(m,{onClick:e[10]||(e[10]=a=>q("prefixes"))},{default:t(()=>[...e[63]||(e[63]=[r("添加",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),l(u,{label:"排除前缀（跳过这些前缀的Key）"},{default:t(()=>[o("div",Vl,[(f(!0),k(P,null,L(s.options.key_filter.exclude_prefixes,(a,v)=>(f(),A(D,{key:"exclude-"+v,closable:"",type:"danger",onClose:K=>ee("exclude_prefixes",v),style:{"margin-right":"8px","margin-bottom":"8px"}},{default:t(()=>[r(_(a),1)]),_:2},1032,["onClose"]))),128)),l(T,{modelValue:E.value,"onUpdate:modelValue":e[14]||(e[14]=a=>E.value=a),placeholder:"输入前缀后按回车添加，如: temp:",style:{width:"280px"},onKeyup:e[15]||(e[15]=se(a=>q("exclude_prefixes"),["enter"]))},{append:t(()=>[l(m,{onClick:e[13]||(e[13]=a=>q("exclude_prefixes"))},{default:t(()=>[...e[64]||(e[64]=[r("添加",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})])):U("",!0),s.options.key_filter.mode==="pattern"?(f(),k("div",xl,[l(u,{label:"正则模式（匹配的Key才会被迁移）"},{default:t(()=>[o("div",Cl,[(f(!0),k(P,null,L(s.options.key_filter.patterns,(a,v)=>(f(),A(D,{key:"pattern-"+v,closable:"",onClose:K=>ee("patterns",v),style:{"margin-right":"8px","margin-bottom":"8px"}},{default:t(()=>[r(_(a),1)]),_:2},1032,["onClose"]))),128)),l(T,{modelValue:W.value,"onUpdate:modelValue":e[17]||(e[17]=a=>W.value=a),placeholder:"输入正则后按回车添加，如: ^user:\\d+$",style:{width:"280px"},onKeyup:e[18]||(e[18]=se(a=>q("patterns"),["enter"]))},{append:t(()=>[l(m,{onClick:e[16]||(e[16]=a=>q("patterns"))},{default:t(()=>[...e[65]||(e[65]=[r("添加",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})])):U("",!0)]),o("div",Ul,[o("h3",null,[l(d,null,{default:t(()=>[l(Re)]),_:1}),e[67]||(e[67]=r(" 高级配置 ",-1)),l(Q,{modelValue:F.value,"onUpdate:modelValue":e[19]||(e[19]=a=>F.value=a),style:{"margin-left":"12px"}},null,8,["modelValue"]),F.value&&((we=y.value)!=null&&we.success)&&((ke=w.value)!=null&&ke.success)?(f(),A(m,{key:0,type:"primary",size:"small",style:{"margin-left":"16px"},onClick:Ae,loading:X.value},{default:t(()=>[l(d,null,{default:t(()=>[l(Me)]),_:1}),e[66]||(e[66]=r(" 智能推荐配置 ",-1))]),_:1},8,["loading"])):U("",!0)]),x.value?(f(),k("div",$l,[l(Pe,{type:"success",closable:!1,"show-icon":""},{title:t(()=>[...e[68]||(e[68]=[o("span",{style:{"font-weight":"bold"}},"推荐配置已生成",-1)])]),default:t(()=>[o("div",Tl,[o("div",Bl,[e[69]||(e[69]=o("span",{class:"label"},"预计迁移速度:",-1)),o("span",Kl,_(le(x.value.estimated_speed))+" keys/s",1)]),o("div",zl,[e[70]||(e[70]=o("span",{class:"label"},"预计完成时间:",-1)),o("span",Al,_(x.value.estimated_time),1)]),o("div",ql,[e[71]||(e[71]=o("span",{class:"label"},"推荐Worker数:",-1)),o("span",Dl,_(x.value.worker_count),1)]),o("div",Sl,[e[72]||(e[72]=o("span",{class:"label"},"推荐连接数:",-1)),o("span",Fl,"源端 "+_(x.value.source_connections)+"，目标端 "+_(x.value.target_connections),1)]),o("div",Rl,[e[73]||(e[73]=o("span",{class:"label"},"推荐理由:",-1)),o("span",Ml,_(x.value.reason),1)])]),l(m,{type:"primary",size:"small",onClick:qe,style:{"margin-top":"12px"}},{default:t(()=>[l(d,null,{default:t(()=>[l(ce)]),_:1}),e[74]||(e[74]=r(" 应用推荐配置 ",-1))]),_:1})]),_:1})])):U("",!0),xe(o("div",Pl,[l(z,{gutter:24},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"Worker数量"},{default:t(()=>[l(B,{modelValue:s.options.worker_count,"onUpdate:modelValue":e[20]||(e[20]=a=>s.options.worker_count=a),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[75]||(e[75]=o("div",{class:"form-tip"},"并行处理的Worker进程数，推荐4-64个",-1))]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"批次大小"},{default:t(()=>[l(B,{modelValue:s.options.scan_batch_size,"onUpdate:modelValue":e[21]||(e[21]=a=>s.options.scan_batch_size=a),min:100,max:1e4,step:100,style:{width:"100%"}},null,8,["modelValue"]),e[76]||(e[76]=o("div",{class:"form-tip"},"每次SCAN扫描的Key数量",-1))]),_:1})]),_:1})]),_:1}),l(z,{gutter:24},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"冲突策略"},{default:t(()=>[l(te,{modelValue:s.options.conflict_policy,"onUpdate:modelValue":e[22]||(e[22]=a=>s.options.conflict_policy=a),style:{width:"100%"}},{default:t(()=>[l(C,{label:"skip_full_only - 全量跳过，增量覆盖",value:"skip_full_only"}),l(C,{label:"skip - 跳过并记录（后续单独处理）",value:"skip"}),l(C,{label:"replace - 直接覆盖",value:"replace"}),l(C,{label:"error - 遇到冲突报错",value:"error"})]),_:1},8,["modelValue"]),e[77]||(e[77]=o("div",{class:"form-tip"},"目标端已存在相同Key时的处理策略",-1))]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"大Key阈值"},{default:t(()=>[l(te,{modelValue:s.options.large_key_threshold,"onUpdate:modelValue":e[23]||(e[23]=a=>s.options.large_key_threshold=a),style:{width:"100%"}},{default:t(()=>[l(C,{label:"1 MB",value:1048576}),l(C,{label:"10 MB",value:10485760}),l(C,{label:"50 MB",value:52428800}),l(C,{label:"100 MB",value:104857600})]),_:1},8,["modelValue"]),e[78]||(e[78]=o("div",{class:"form-tip"},"超过此大小的Key将特殊处理",-1))]),_:1})]),_:1})]),_:1}),l(z,{gutter:24},{default:t(()=>[l(b,{span:8},{default:t(()=>[l(u,{label:"启用压缩"},{default:t(()=>[l(Q,{modelValue:s.options.enable_compression,"onUpdate:modelValue":e[24]||(e[24]=a=>s.options.enable_compression=a)},null,8,["modelValue"]),e[79]||(e[79]=o("div",{class:"form-tip"},"对大Key数据启用LZ4压缩传输",-1))]),_:1})]),_:1}),l(b,{span:8},{default:t(()=>[l(u,{label:"跳过全量阶段"},{default:t(()=>[l(Q,{modelValue:s.options.skip_full_sync,"onUpdate:modelValue":e[25]||(e[25]=a=>s.options.skip_full_sync=a)},null,8,["modelValue"]),e[80]||(e[80]=o("div",{class:"form-tip"},"跳过全量迁移，仅执行增量同步",-1))]),_:1})]),_:1}),l(b,{span:8},{default:t(()=>[l(u,{label:"跳过增量阶段"},{default:t(()=>[l(Q,{modelValue:s.options.skip_incremental,"onUpdate:modelValue":e[26]||(e[26]=a=>s.options.skip_incremental=a)},null,8,["modelValue"]),e[81]||(e[81]=o("div",{class:"form-tip"},"跳过增量同步阶段",-1))]),_:1})]),_:1})]),_:1}),o("div",Ll,[e[86]||(e[86]=o("h4",null,"限速配置",-1)),l(z,{gutter:24},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"源端QPS限制"},{default:t(()=>[l(B,{modelValue:s.options.rate_limit.source_qps,"onUpdate:modelValue":e[27]||(e[27]=a=>s.options.rate_limit.source_qps=a),min:0,max:1e5,step:1e3,style:{width:"100%"}},null,8,["modelValue"]),e[82]||(e[82]=o("div",{class:"form-tip"},"0表示不限制",-1))]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"目标端QPS限制"},{default:t(()=>[l(B,{modelValue:s.options.rate_limit.target_qps,"onUpdate:modelValue":e[28]||(e[28]=a=>s.options.rate_limit.target_qps=a),min:0,max:1e5,step:1e3,style:{width:"100%"}},null,8,["modelValue"]),e[83]||(e[83]=o("div",{class:"form-tip"},"0表示不限制",-1))]),_:1})]),_:1})]),_:1}),l(z,{gutter:24},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"源端连接数"},{default:t(()=>[l(B,{modelValue:s.options.rate_limit.source_connections,"onUpdate:modelValue":e[29]||(e[29]=a=>s.options.rate_limit.source_connections=a),min:1,max:500,style:{width:"100%"}},null,8,["modelValue"]),e[84]||(e[84]=o("div",{class:"form-tip"},"建议设置为 Worker数 × 2，不超过源端 maxclients 的 10%",-1))]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"目标端连接数"},{default:t(()=>[l(B,{modelValue:s.options.rate_limit.target_connections,"onUpdate:modelValue":e[30]||(e[30]=a=>s.options.rate_limit.target_connections=a),min:1,max:200,style:{width:"100%"}},null,8,["modelValue"]),e[85]||(e[85]=o("div",{class:"form-tip"},"建议设置为 Worker数 × 2，不超过目标端 maxclients 的 10%",-1))]),_:1})]),_:1})]),_:1})]),o("div",Nl,[e[90]||(e[90]=o("h4",null,"重试配置",-1)),l(z,{gutter:24},{default:t(()=>[l(b,{span:8},{default:t(()=>[l(u,{label:"最大重试次数"},{default:t(()=>[l(B,{modelValue:s.options.retry_config.max_retries,"onUpdate:modelValue":e[31]||(e[31]=a=>s.options.retry_config.max_retries=a),min:0,max:10,style:{width:"100%"}},null,8,["modelValue"]),e[87]||(e[87]=o("div",{class:"form-tip"},"迁移失败时的重试次数，0表示不重试",-1))]),_:1})]),_:1}),l(b,{span:8},{default:t(()=>[l(u,{label:"全量重试间隔(ms)"},{default:t(()=>[l(B,{modelValue:s.options.retry_config.full_retry_interval_ms,"onUpdate:modelValue":e[32]||(e[32]=a=>s.options.retry_config.full_retry_interval_ms=a),min:50,max:5e3,step:50,style:{width:"100%"}},null,8,["modelValue"]),e[88]||(e[88]=o("div",{class:"form-tip"},"全量迁移阶段重试间隔基数",-1))]),_:1})]),_:1}),l(b,{span:8},{default:t(()=>[l(u,{label:"增量重试间隔(ms)"},{default:t(()=>[l(B,{modelValue:s.options.retry_config.incr_retry_interval_ms,"onUpdate:modelValue":e[33]||(e[33]=a=>s.options.retry_config.incr_retry_interval_ms=a),min:100,max:1e4,step:100,style:{width:"100%"}},null,8,["modelValue"]),e[89]||(e[89]=o("div",{class:"form-tip"},"增量同步阶段重试间隔基数",-1))]),_:1})]),_:1})]),_:1})])],512),[[Ge,F.value]])]),o("div",El,[o("div",Wl,[l(Oe,{onCommand:$e,trigger:"click"},{dropdown:t(()=>[l(We,null,{default:t(()=>[l(ve,{command:"save"},{default:t(()=>[l(d,null,{default:t(()=>[l(Ne)]),_:1}),e[92]||(e[92]=r(" 保存为模板 ",-1))]),_:1}),l(ve,{command:"load",divided:""},{default:t(()=>[l(d,null,{default:t(()=>[l(Ee)]),_:1}),e[93]||(e[93]=r(" 从模板加载 ",-1))]),_:1})]),_:1})]),default:t(()=>[l(m,null,{default:t(()=>[l(d,null,{default:t(()=>[l(pe)]),_:1}),e[91]||(e[91]=r(" 模板 ",-1)),l(d,null,{default:t(()=>[l(Le)]),_:1})]),_:1})]),_:1})]),o("div",Ol,[l(m,{onClick:e[34]||(e[34]=a=>n.$router.push("/tasks"))},{default:t(()=>[...e[94]||(e[94]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:De,loading:Z.value},{default:t(()=>[...e[95]||(e[95]=[r(" 创建任务 ",-1)])]),_:1},8,["loading"])])])]}),_:1},8,["model"])]),l(ye,{modelValue:R.value,"onUpdate:modelValue":e[38]||(e[38]=c=>R.value=c),title:"保存为模板",width:"500px"},{footer:t(()=>[l(m,{onClick:e[37]||(e[37]=c=>R.value=!1)},{default:t(()=>[...e[96]||(e[96]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:Te,loading:Y.value},{default:t(()=>[...e[97]||(e[97]=[r("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(ge,{model:$,"label-width":"80px"},{default:t(()=>[l(u,{label:"模板名称",required:""},{default:t(()=>[l(T,{modelValue:$.name,"onUpdate:modelValue":e[35]||(e[35]=c=>$.name=c),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"描述"},{default:t(()=>[l(T,{modelValue:$.description,"onUpdate:modelValue":e[36]||(e[36]=c=>$.description=c),type:"textarea",rows:3,placeholder:"可选，描述模板用途"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(ye,{modelValue:O.value,"onUpdate:modelValue":e[39]||(e[39]=c=>O.value=c),title:"从模板加载",width:"800px"},{default:t(()=>[xe((f(),A(je,{data:h.value,style:{width:"100%"},"max-height":"400"},{default:t(()=>[l(M,{prop:"name",label:"模板名称","min-width":"120"}),l(M,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),l(M,{prop:"migration_mode",label:"迁移模式",width:"100",align:"center"},{default:t(({row:c})=>[l(D,{type:c.migration_mode==="full_only"?"info":"success",size:"small"},{default:t(()=>[r(_(c.migration_mode==="full_only"?"全量":"全量+增量"),1)]),_:2},1032,["type"])]),_:1}),l(M,{prop:"created_at",label:"创建时间",width:"170",align:"center"},{default:t(({row:c})=>[r(_(ze(c.created_at)),1)]),_:1}),l(M,{label:"操作",width:"140",align:"center",fixed:"right"},{default:t(({row:c})=>[l(m,{type:"primary",size:"small",onClick:G=>Be(c)},{default:t(()=>[l(d,null,{default:t(()=>[l(ce)]),_:1}),e[98]||(e[98]=r(" 加载 ",-1))]),_:1},8,["onClick"]),l(m,{type:"danger",size:"small",text:"",onClick:G=>Ke(c)},{default:t(()=>[...e[99]||(e[99]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ie,j.value]]),h.value.length===0&&!j.value?(f(),k("div",jl," 暂无保存的模板 ")):U("",!0)]),_:1},8,["modelValue"])])}}},Zl=Qe(Il,[["__scopeId","data-v-b9a4f309"]]);export{Zl as default};
