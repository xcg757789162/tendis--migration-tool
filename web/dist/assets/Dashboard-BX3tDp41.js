import{_ as H,o as J,a as O,b as _,c as g,d as s,e,w as a,t as i,f as u,F as Q,r as X,n as Y,g as Z,h as ss,i as h,j as l,k as T,u as ts,E}from"./index-C5Ql7TWZ.js";const es={class:"dashboard"},os={class:"stats-grid"},ns={class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},as={class:"stat-content"},ls={class:"stat-number"},is={class:"stat-icon",style:{background:"linear-gradient(135deg, #10b981 0%, #34d399 100%)"}},ds={class:"stat-content"},rs={class:"stat-number"},cs={class:"stat-icon",style:{background:"linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)"}},us={class:"stat-content"},_s={class:"stat-number"},vs={class:"stat-icon",style:{background:"linear-gradient(135deg, #2563eb 0%, #06b6d4 100%)"}},ps={class:"stat-content"},gs={class:"stat-number"},ks={class:"section"},fs={class:"section-header"},ms={key:0,class:"running-tasks"},bs={class:"task-header"},ys={class:"task-name"},hs={class:"task-progress"},Ts={class:"progress-info"},Cs={class:"progress-percent"},ws={class:"progress-bar"},zs={class:"task-stats"},$s={class:"stat-item"},Vs={class:"value"},xs={class:"stat-item"},Fs={class:"value"},Ss={class:"stat-item"},Bs={class:"value"},Ds={class:"stat-item"},Ms={class:"value"},Ns={class:"task-actions"},Ps={class:"section"},Es={class:"section-header"},Is={class:"system-info"},Rs={class:"info-card"},As={class:"info-icon"},Ks={class:"info-content"},js={class:"info-value"},qs={class:"info-card"},Ls={class:"info-icon"},Us={class:"info-content"},Ws={__name:"Dashboard",setup(Gs){const C=ts(),c=T({totalTasks:0,runningTasks:0,pausedTasks:0,completedTasks:0}),k=T([]),v=T({});let f=null;const m=async()=>{try{const o=await h.getTasks({page:1,size:100}),t=o.items||[];c.value.totalTasks=o.total||0,c.value.runningTasks=t.filter(r=>r.status==="running").length,c.value.pausedTasks=t.filter(r=>r.status==="paused").length,c.value.completedTasks=t.filter(r=>r.status==="completed").length,k.value=t.filter(r=>r.status==="running").slice(0,3),v.value=await h.getSystemStatus()}catch(o){console.error("Fetch data failed:",o)}},I=async o=>{try{await h.pauseTask(o),E.success("任务已暂停"),m()}catch{E.error("暂停失败")}},p=o=>{o==="all"?C.push("/tasks"):C.push({path:"/tasks",query:{status:o}})},b=o=>o>=1e9?(o/1e9).toFixed(1)+"B":o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toString();return J(()=>{m(),f=setInterval(m,5e3)}),O(()=>{f&&clearInterval(f)}),(o,t)=>{const r=l("Tickets"),d=l("el-icon"),w=l("VideoPlay"),z=l("VideoPause"),R=l("CircleCheck"),A=l("ArrowRight"),K=l("router-link"),y=l("el-button"),j=l("View"),q=l("el-empty"),L=l("Monitor"),U=l("Cpu"),W=l("Connection");return _(),g("div",es,[t[23]||(t[23]=s("div",{class:"page-header"},[s("h1",null,"控制台"),s("p",null,"实时监控迁移任务状态和系统运行情况")],-1)),s("div",os,[s("div",{class:"stat-card clickable",onClick:t[0]||(t[0]=n=>p("all"))},[s("div",ns,[e(d,{size:24},{default:a(()=>[e(r)]),_:1})]),s("div",as,[s("div",ls,i(c.value.totalTasks),1),t[5]||(t[5]=s("div",{class:"stat-label"},"总任务数",-1))])]),s("div",{class:"stat-card clickable",onClick:t[1]||(t[1]=n=>p("running"))},[s("div",is,[e(d,{size:24},{default:a(()=>[e(w)]),_:1})]),s("div",ds,[s("div",rs,i(c.value.runningTasks),1),t[6]||(t[6]=s("div",{class:"stat-label"},"运行中",-1))])]),s("div",{class:"stat-card clickable",onClick:t[2]||(t[2]=n=>p("paused"))},[s("div",cs,[e(d,{size:24},{default:a(()=>[e(z)]),_:1})]),s("div",us,[s("div",_s,i(c.value.pausedTasks),1),t[7]||(t[7]=s("div",{class:"stat-label"},"已暂停",-1))])]),s("div",{class:"stat-card clickable",onClick:t[3]||(t[3]=n=>p("completed"))},[s("div",vs,[e(d,{size:24},{default:a(()=>[e(R)]),_:1})]),s("div",ps,[s("div",gs,i(c.value.completedTasks),1),t[8]||(t[8]=s("div",{class:"stat-label"},"已完成",-1))])])]),s("div",ks,[s("div",fs,[s("h2",null,[e(d,null,{default:a(()=>[e(w)]),_:1}),t[9]||(t[9]=u(" 运行中的任务 ",-1))]),e(K,{to:"/tasks",class:"view-all"},{default:a(()=>[t[10]||(t[10]=u("查看全部 ",-1)),e(d,null,{default:a(()=>[e(A)]),_:1})]),_:1})]),k.value.length?(_(),g("div",ms,[(_(!0),g(Q,null,X(k.value,n=>{var $,V,x,F,S,B,D,M,N,P;return _(),g("div",{class:"task-card",key:n.id},[s("div",bs,[s("div",ys,i(n.name),1),t[11]||(t[11]=s("span",{class:"status-tag running"},"运行中",-1))]),s("div",hs,[s("div",Ts,[t[12]||(t[12]=s("span",null,"迁移进度",-1)),s("span",Cs,i(((V=($=n.progress)==null?void 0:$.percentage)==null?void 0:V.toFixed(1))||0)+"%",1)]),s("div",ws,[s("div",{class:"progress-inner",style:Y({width:(((x=n.progress)==null?void 0:x.percentage)||0)+"%"})},null,4)])]),s("div",zs,[s("div",$s,[t[13]||(t[13]=s("span",{class:"label"},"已迁移",-1)),s("span",Vs,i(b(((F=n.progress)==null?void 0:F.keys_migrated)||((S=n.progress)==null?void 0:S.migrated_keys)||0)),1)]),s("div",xs,[t[14]||(t[14]=s("span",{class:"label"},"总Key数",-1)),s("span",Fs,i(b(((B=n.progress)==null?void 0:B.keys_total)||((D=n.progress)==null?void 0:D.total_keys)||0)),1)]),s("div",Ss,[t[15]||(t[15]=s("span",{class:"label"},"速度",-1)),s("span",Bs,i(b(((M=n.progress)==null?void 0:M.speed)||((N=n.progress)==null?void 0:N.current_speed)||0))+" keys/s",1)]),s("div",Ds,[t[16]||(t[16]=s("span",{class:"label"},"预计剩余",-1)),s("span",Ms,i(((P=n.progress)==null?void 0:P.estimated_eta)||"-"),1)])]),s("div",Ns,[e(y,{size:"small",onClick:G=>I(n.id)},{default:a(()=>[e(d,null,{default:a(()=>[e(z)]),_:1}),t[17]||(t[17]=u(" 暂停 ",-1))]),_:1},8,["onClick"]),e(y,{size:"small",type:"primary",onClick:G=>o.$router.push(`/tasks/${n.id}`)},{default:a(()=>[e(d,null,{default:a(()=>[e(j)]),_:1}),t[18]||(t[18]=u(" 详情 ",-1))]),_:1},8,["onClick"])])])}),128))])):(_(),Z(q,{key:1,description:"暂无运行中的任务"},{default:a(()=>[e(y,{type:"primary",onClick:t[4]||(t[4]=n=>o.$router.push("/create"))},{default:a(()=>[...t[19]||(t[19]=[u("创建任务",-1)])]),_:1})]),_:1}))]),s("div",Ps,[s("div",Es,[s("h2",null,[e(d,null,{default:a(()=>[e(L)]),_:1}),t[20]||(t[20]=u(" 系统状态 ",-1))])]),s("div",Is,[s("div",Rs,[s("div",As,[e(d,{size:20},{default:a(()=>[e(U)]),_:1})]),s("div",Ks,[t[21]||(t[21]=s("div",{class:"info-label"},"Worker 进程",-1)),s("div",js,i(v.value.worker_count||0)+" 个运行中",1)])]),s("div",qs,[s("div",Ls,[e(d,{size:20},{default:a(()=>[e(W)]),_:1})]),s("div",Us,[t[22]||(t[22]=s("div",{class:"info-label"},"系统状态",-1)),s("div",{class:ss(["info-value",v.value.status])},i(v.value.status==="running"?"正常运行":"检查中"),3)])])])])])}}},Js=H(Ws,[["__scopeId","data-v-871b339f"]]);export{Js as default};
