import{_ as q,o as G,a as H,b as u,c as p,d as s,e,w as a,t as l,f as _,F as J,r as O,n as Q,g as X,h as Y,i as b,j as i,k as y,E as N}from"./index-BRvMW0-A.js";const Z={class:"dashboard"},ss={class:"stats-grid"},ts={class:"stat-card"},es={class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},os={class:"stat-content"},as={class:"stat-number"},ns={class:"stat-card"},is={class:"stat-icon",style:{background:"linear-gradient(135deg, #10b981 0%, #34d399 100%)"}},ls={class:"stat-content"},ds={class:"stat-number"},rs={class:"stat-card"},cs={class:"stat-icon",style:{background:"linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)"}},_s={class:"stat-content"},us={class:"stat-number"},vs={class:"stat-card"},ps={class:"stat-icon",style:{background:"linear-gradient(135deg, #2563eb 0%, #06b6d4 100%)"}},gs={class:"stat-content"},fs={class:"stat-number"},ms={class:"section"},ks={class:"section-header"},hs={key:0,class:"running-tasks"},bs={class:"task-header"},ys={class:"task-name"},Ts={class:"task-progress"},Cs={class:"progress-info"},ws={class:"progress-percent"},zs={class:"progress-bar"},Vs={class:"task-stats"},xs={class:"stat-item"},Fs={class:"value"},Ss={class:"stat-item"},$s={class:"value"},Bs={class:"stat-item"},Ds={class:"value"},Ms={class:"stat-item"},Ns={class:"value"},Ps={class:"task-actions"},Es={class:"section"},Is={class:"section-header"},As={class:"system-info"},Ks={class:"info-card"},Rs={class:"info-icon"},js={class:"info-content"},Ls={class:"info-value"},Us={class:"info-card"},Ws={class:"info-icon"},qs={class:"info-content"},Gs={__name:"Dashboard",setup(Hs){const c=y({totalTasks:0,runningTasks:0,pausedTasks:0,completedTasks:0}),g=y([]),v=y({});let f=null;const m=async()=>{try{const o=await b.getTasks({page:1,size:100}),t=o.items||[];c.value.totalTasks=o.total||0,c.value.runningTasks=t.filter(r=>r.status==="running").length,c.value.pausedTasks=t.filter(r=>r.status==="paused").length,c.value.completedTasks=t.filter(r=>r.status==="completed").length,g.value=t.filter(r=>r.status==="running").slice(0,3),v.value=await b.getSystemStatus()}catch(o){console.error("Fetch data failed:",o)}},P=async o=>{try{await b.pauseTask(o),N.success("任务已暂停"),m()}catch{N.error("暂停失败")}},k=o=>o>=1e9?(o/1e9).toFixed(1)+"B":o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toString();return G(()=>{m(),f=setInterval(m,5e3)}),H(()=>{f&&clearInterval(f)}),(o,t)=>{const r=i("Tickets"),d=i("el-icon"),T=i("VideoPlay"),C=i("VideoPause"),E=i("CircleCheck"),I=i("ArrowRight"),A=i("router-link"),h=i("el-button"),K=i("View"),R=i("el-empty"),j=i("Monitor"),L=i("Cpu"),U=i("Connection");return u(),p("div",Z,[t[19]||(t[19]=s("div",{class:"page-header"},[s("h1",null,"控制台"),s("p",null,"实时监控迁移任务状态和系统运行情况")],-1)),s("div",ss,[s("div",ts,[s("div",es,[e(d,{size:24},{default:a(()=>[e(r)]),_:1})]),s("div",os,[s("div",as,l(c.value.totalTasks),1),t[1]||(t[1]=s("div",{class:"stat-label"},"总任务数",-1))])]),s("div",ns,[s("div",is,[e(d,{size:24},{default:a(()=>[e(T)]),_:1})]),s("div",ls,[s("div",ds,l(c.value.runningTasks),1),t[2]||(t[2]=s("div",{class:"stat-label"},"运行中",-1))])]),s("div",rs,[s("div",cs,[e(d,{size:24},{default:a(()=>[e(C)]),_:1})]),s("div",_s,[s("div",us,l(c.value.pausedTasks),1),t[3]||(t[3]=s("div",{class:"stat-label"},"已暂停",-1))])]),s("div",vs,[s("div",ps,[e(d,{size:24},{default:a(()=>[e(E)]),_:1})]),s("div",gs,[s("div",fs,l(c.value.completedTasks),1),t[4]||(t[4]=s("div",{class:"stat-label"},"已完成",-1))])])]),s("div",ms,[s("div",ks,[s("h2",null,[e(d,null,{default:a(()=>[e(T)]),_:1}),t[5]||(t[5]=_(" 运行中的任务 ",-1))]),e(A,{to:"/tasks",class:"view-all"},{default:a(()=>[t[6]||(t[6]=_("查看全部 ",-1)),e(d,null,{default:a(()=>[e(I)]),_:1})]),_:1})]),g.value.length?(u(),p("div",hs,[(u(!0),p(J,null,O(g.value,n=>{var w,z,V,x,F,S,$,B,D,M;return u(),p("div",{class:"task-card",key:n.id},[s("div",bs,[s("div",ys,l(n.name),1),t[7]||(t[7]=s("span",{class:"status-tag running"},"运行中",-1))]),s("div",Ts,[s("div",Cs,[t[8]||(t[8]=s("span",null,"迁移进度",-1)),s("span",ws,l(((z=(w=n.progress)==null?void 0:w.percentage)==null?void 0:z.toFixed(1))||0)+"%",1)]),s("div",zs,[s("div",{class:"progress-inner",style:Q({width:(((V=n.progress)==null?void 0:V.percentage)||0)+"%"})},null,4)])]),s("div",Vs,[s("div",xs,[t[9]||(t[9]=s("span",{class:"label"},"已迁移",-1)),s("span",Fs,l(k(((x=n.progress)==null?void 0:x.keys_migrated)||((F=n.progress)==null?void 0:F.migrated_keys)||0)),1)]),s("div",Ss,[t[10]||(t[10]=s("span",{class:"label"},"总Key数",-1)),s("span",$s,l(k(((S=n.progress)==null?void 0:S.keys_total)||(($=n.progress)==null?void 0:$.total_keys)||0)),1)]),s("div",Bs,[t[11]||(t[11]=s("span",{class:"label"},"速度",-1)),s("span",Ds,l(k(((B=n.progress)==null?void 0:B.speed)||((D=n.progress)==null?void 0:D.current_speed)||0))+" keys/s",1)]),s("div",Ms,[t[12]||(t[12]=s("span",{class:"label"},"预计剩余",-1)),s("span",Ns,l(((M=n.progress)==null?void 0:M.estimated_eta)||"-"),1)])]),s("div",Ps,[e(h,{size:"small",onClick:W=>P(n.id)},{default:a(()=>[e(d,null,{default:a(()=>[e(C)]),_:1}),t[13]||(t[13]=_(" 暂停 ",-1))]),_:1},8,["onClick"]),e(h,{size:"small",type:"primary",onClick:W=>o.$router.push(`/tasks/${n.id}`)},{default:a(()=>[e(d,null,{default:a(()=>[e(K)]),_:1}),t[14]||(t[14]=_(" 详情 ",-1))]),_:1},8,["onClick"])])])}),128))])):(u(),X(R,{key:1,description:"暂无运行中的任务"},{default:a(()=>[e(h,{type:"primary",onClick:t[0]||(t[0]=n=>o.$router.push("/create"))},{default:a(()=>[...t[15]||(t[15]=[_("创建任务",-1)])]),_:1})]),_:1}))]),s("div",Es,[s("div",Is,[s("h2",null,[e(d,null,{default:a(()=>[e(j)]),_:1}),t[16]||(t[16]=_(" 系统状态 ",-1))])]),s("div",As,[s("div",Ks,[s("div",Rs,[e(d,{size:20},{default:a(()=>[e(L)]),_:1})]),s("div",js,[t[17]||(t[17]=s("div",{class:"info-label"},"Worker 进程",-1)),s("div",Ls,l(v.value.worker_count||0)+" 个运行中",1)])]),s("div",Us,[s("div",Ws,[e(d,{size:20},{default:a(()=>[e(U)]),_:1})]),s("div",qs,[t[18]||(t[18]=s("div",{class:"info-label"},"系统状态",-1)),s("div",{class:Y(["info-value",v.value.status])},l(v.value.status==="running"?"正常运行":"检查中"),3)])])])])])}}},Os=q(Gs,[["__scopeId","data-v-c7817a9c"]]);export{Os as default};
