import{_ as Ve,o as De,a as Fe,b as u,c as _,d as t,e as s,w as o,f as v,g as F,t as d,m as p,y as $e,F as E,r as O,z as Re,h as I,l as Se,i as z,j as i,k as g,C as ze,E as y}from"./index-BRvMW0-A.js";const Ne={class:"logs-view"},je={class:"page-header"},qe={class:"header-content"},Ae={class:"page-title"},Ee={class:"header-actions"},Oe={style:{"font-size":"12px",color:"#409EFF","font-weight":"500"}},Ie={class:"stats-row"},Te={class:"stat-card"},Ue={class:"stat-icon total"},Be={class:"stat-info"},Pe={class:"stat-value"},We={class:"stat-card"},Je={class:"stat-icon error"},Me={class:"stat-info"},Ge={class:"stat-value"},Ke={class:"stat-card"},He={class:"stat-icon warn"},Qe={class:"stat-info"},Xe={class:"stat-value"},Ye={class:"stat-card"},Ze={class:"stat-icon info"},et={class:"stat-info"},tt={class:"stat-value"},st={class:"stat-card"},lt={class:"stat-icon uptime"},ot={class:"stat-info"},at={class:"stat-value uptime-text"},nt={class:"filter-section"},it={class:"filter-row"},dt={class:"logs-container"},ut={class:"logs-header"},rt={class:"logs-count"},ct={class:"logs-actions"},_t={class:"logs-list"},vt={key:0,class:"empty-state"},pt=["onClick"],mt={class:"log-header"},ft={class:"log-time"},gt={key:0,class:"log-source"},kt={key:1,class:"log-tag request"},yt={key:2,class:"log-tag task"},bt={class:"log-message"},ht={key:0,class:"log-fields"},wt={class:"field-key"},Ct={class:"field-value"},xt={class:"log-actions"},Lt={key:0,class:"pagination-wrapper"},Vt={key:0,class:"log-detail"},Dt={class:"detail-section"},Ft={class:"detail-grid"},$t={class:"detail-item"},Rt={class:"value"},St={class:"detail-item"},zt={class:"detail-item"},Nt={class:"value"},jt={class:"detail-item"},qt={class:"value"},At={key:0,class:"detail-item"},Et={class:"value mono"},Ot={key:1,class:"detail-item"},It={class:"value mono"},Tt={class:"detail-section"},Ut={class:"message-box"},Bt={key:0,class:"detail-section"},Pt={class:"fields-json"},Wt={key:1,class:"detail-section"},Jt={class:"stack-trace"},Mt={__name:"Logs",setup(Gt){const L=g(!1),h=g([]),$=g(0),b=g(1),w=g(100),T=g(!1),R=g(!1),c=g(null),N=g([]);let V=null;const C=g({total:0,by_level:{},uptime:"-",memory_mb:0}),r=g({level:"",keyword:"",task_id:"",request_id:""}),D=async()=>{L.value=!0;try{const l={limit:w.value,offset:(b.value-1)*w.value,level:r.value.level,keyword:r.value.keyword,task_id:r.value.task_id,request_id:r.value.request_id},e=await z.getLogs(l);h.value=e.items||[],$.value=e.total||0}catch(l){console.error("Failed to fetch logs:",l)}finally{L.value=!1}},X=async()=>{try{const l=await z.getLogsStats();C.value=l}catch(l){console.error("Failed to fetch stats:",l)}},Y=async()=>{try{const l=await z.getTasks();N.value=l.items||[]}catch(l){console.error("Failed to fetch tasks:",l)}},Z=l=>{const e=N.value.find(m=>m.id===l);return e?`${e.name} (${l.substring(0,8)})`:l.substring(0,8)},S=()=>{D(),X()},U=()=>{b.value=1,D()},ee=()=>{r.value={level:"",keyword:"",task_id:"",request_id:""},b.value=1,D()},te=l=>{b.value=l,D()},se=l=>{w.value=l,b.value=1,D()},le=l=>{l?V=setInterval(S,5e3):(clearInterval(V),V=null)},oe=async l=>{try{let e=l,m="";l.startsWith("task-")&&(e=l.replace("task-",""),m=r.value.task_id);const n=new URLSearchParams;n.set("format",e),r.value.level&&n.set("level",r.value.level),r.value.keyword&&n.set("keyword",r.value.keyword),m&&n.set("task_id",m);const j=`/api/v1/logs/export?${n.toString()}`,f=document.createElement("a");f.href=j,document.body.appendChild(f),f.click(),document.body.removeChild(f),y.success(m?"任务日志导出成功":"日志导出成功")}catch(e){y.error("导出失败: "+e.message)}},ae=async()=>{try{await z.clearLogs(),y.success("日志已清除"),S()}catch(l){y.error("清除失败: "+l.message)}},ne=l=>{c.value=l,R.value=!0},ie=l=>typeof l=="object"?JSON.stringify(l):String(l),B=l=>{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(l);const e=document.createElement("textarea");e.value=l,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select();try{return document.execCommand("copy"),Promise.resolve()}catch(m){return Promise.reject(m)}finally{document.body.removeChild(e)}},P=l=>{const e=W(l);B(e).then(()=>{y.success("已复制到剪贴板")}).catch(()=>{y.error("复制失败")})},de=()=>{const l=h.value.map(W).join(`

`);B(l).then(()=>{y.success(`已复制 ${h.value.length} 条日志`)}).catch(()=>{y.error("复制失败")})},W=l=>{let e=`[${l.timestamp}] [${l.level}]`;return l.source&&(e+=` [${l.source}]`),l.request_id&&(e+=` [req:${l.request_id.substring(0,8)}]`),l.task_id&&(e+=` [task:${l.task_id.substring(0,8)}]`),e+=` ${l.message}`,l.fields&&Object.keys(l.fields).length>0&&(e+=`
  Fields: ${JSON.stringify(l.fields)}`),l.stack&&(e+=`
  Stack:
${l.stack}`),e};return De(()=>{Y(),S()}),Fe(()=>{V&&clearInterval(V)}),(l,e)=>{var G,K,H;const m=i("Document"),n=i("el-icon"),j=i("Refresh"),f=i("el-button"),ue=i("Delete"),re=i("el-popconfirm"),ce=i("Download"),_e=i("ArrowDown"),x=i("el-dropdown-item"),ve=i("el-dropdown-menu"),pe=i("el-dropdown"),me=i("CircleClose"),fe=i("Warning"),ge=i("InfoFilled"),ke=i("Timer"),J=i("Search"),ye=i("el-input"),k=i("el-option"),M=i("el-select"),be=i("el-checkbox"),q=i("CopyDocument"),he=i("Connection"),we=i("Files"),Ce=i("el-pagination"),xe=i("el-dialog"),Le=ze("loading");return u(),_("div",Ne,[t("div",je,[t("div",qe,[t("h1",Ae,[s(n,null,{default:o(()=>[s(m)]),_:1}),e[9]||(e[9]=v(" 系统日志 ",-1))]),e[10]||(e[10]=t("p",{class:"page-desc"},"查看、搜索和导出系统运行日志，便于故障排查",-1))]),t("div",Ee,[s(f,{onClick:S,loading:L.value},{default:o(()=>[s(n,null,{default:o(()=>[s(j)]),_:1}),e[11]||(e[11]=v("刷新 ",-1))]),_:1},8,["loading"]),s(re,{title:"确定要清除所有日志吗？此操作不可恢复！","confirm-button-text":"确定清除","cancel-button-text":"取消",onConfirm:ae},{reference:o(()=>[s(f,{type:"danger",plain:""},{default:o(()=>[s(n,null,{default:o(()=>[s(ue)]),_:1}),e[12]||(e[12]=v("清除全部 ",-1))]),_:1})]),_:1}),s(pe,{onCommand:oe},{dropdown:o(()=>[s(ve,null,{default:o(()=>[s(x,{command:"text"},{default:o(()=>[...e[14]||(e[14]=[v("导出全部日志 (.txt)",-1)])]),_:1}),s(x,{command:"json"},{default:o(()=>[...e[15]||(e[15]=[v("导出全部日志 (.json)",-1)])]),_:1}),r.value.task_id?(u(),F(x,{key:0,divided:""},{default:o(()=>[t("span",Oe," 当前筛选任务: "+d(Z(r.value.task_id)),1)]),_:1})):p("",!0),r.value.task_id?(u(),F(x,{key:1,command:"task-text"},{default:o(()=>[s(n,null,{default:o(()=>[s(m)]),_:1}),e[16]||(e[16]=v(" 导出当前任务日志 (.txt) ",-1))]),_:1})):p("",!0),r.value.task_id?(u(),F(x,{key:2,command:"task-json"},{default:o(()=>[s(n,null,{default:o(()=>[s(m)]),_:1}),e[17]||(e[17]=v(" 导出当前任务日志 (.json) ",-1))]),_:1})):p("",!0),r.value.task_id?p("",!0):(u(),F(x,{key:3,divided:"",disabled:""},{default:o(()=>[...e[18]||(e[18]=[t("span",{style:{"font-size":"12px",color:"#999"}},"提示: 选择任务后可单独导出",-1)])]),_:1}))]),_:1})]),default:o(()=>[s(f,{type:"primary"},{default:o(()=>[s(n,null,{default:o(()=>[s(ce)]),_:1}),e[13]||(e[13]=v("导出日志 ",-1)),s(n,{class:"el-icon--right"},{default:o(()=>[s(_e)]),_:1})]),_:1})]),_:1})])]),t("div",Ie,[t("div",Te,[t("div",Ue,[s(n,null,{default:o(()=>[s(m)]),_:1})]),t("div",Be,[t("span",Pe,d(C.value.total),1),e[19]||(e[19]=t("span",{class:"stat-label"},"总日志数",-1))])]),t("div",We,[t("div",Je,[s(n,null,{default:o(()=>[s(me)]),_:1})]),t("div",Me,[t("span",Ge,d(((G=C.value.by_level)==null?void 0:G.ERROR)||0),1),e[20]||(e[20]=t("span",{class:"stat-label"},"错误",-1))])]),t("div",Ke,[t("div",He,[s(n,null,{default:o(()=>[s(fe)]),_:1})]),t("div",Qe,[t("span",Xe,d(((K=C.value.by_level)==null?void 0:K.WARN)||0),1),e[21]||(e[21]=t("span",{class:"stat-label"},"警告",-1))])]),t("div",Ye,[t("div",Ze,[s(n,null,{default:o(()=>[s(ge)]),_:1})]),t("div",et,[t("span",tt,d(((H=C.value.by_level)==null?void 0:H.INFO)||0),1),e[22]||(e[22]=t("span",{class:"stat-label"},"信息",-1))])]),t("div",st,[t("div",lt,[s(n,null,{default:o(()=>[s(ke)]),_:1})]),t("div",ot,[t("span",at,d(C.value.uptime||"-"),1),e[23]||(e[23]=t("span",{class:"stat-label"},"运行时间",-1))])])]),t("div",nt,[t("div",it,[s(ye,{modelValue:r.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.keyword=a),placeholder:"搜索日志内容...",clearable:"",class:"search-input",onKeyup:$e(U,["enter"])},{prefix:o(()=>[s(n,null,{default:o(()=>[s(J)]),_:1})]),_:1},8,["modelValue"]),s(M,{modelValue:r.value.level,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.level=a),placeholder:"日志级别",clearable:"",class:"filter-select"},{default:o(()=>[s(k,{label:"全部级别",value:""}),s(k,{label:"DEBUG",value:"DEBUG"}),s(k,{label:"INFO",value:"INFO"}),s(k,{label:"WARN",value:"WARN"}),s(k,{label:"ERROR",value:"ERROR"}),s(k,{label:"FATAL",value:"FATAL"})]),_:1},8,["modelValue"]),s(M,{modelValue:r.value.task_id,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.task_id=a),placeholder:"选择任务",clearable:"",filterable:"",class:"filter-select-task"},{default:o(()=>[s(k,{label:"全部任务",value:""}),(u(!0),_(E,null,O(N.value,a=>(u(),F(k,{key:a.id,label:`${a.name} (${a.id.substring(0,8)})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(f,{type:"primary",onClick:U},{default:o(()=>[s(n,null,{default:o(()=>[s(J)]),_:1}),e[24]||(e[24]=v("搜索 ",-1))]),_:1}),s(f,{onClick:ee},{default:o(()=>[...e[25]||(e[25]=[v("重置",-1)])]),_:1})])]),t("div",dt,[t("div",ut,[t("span",rt,"共 "+d($.value)+" 条日志",1),t("div",ct,[s(be,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=a=>T.value=a),onChange:le},{default:o(()=>[...e[26]||(e[26]=[v(" 自动刷新 (5s) ",-1)])]),_:1},8,["modelValue"]),s(f,{text:"",onClick:de,disabled:h.value.length===0},{default:o(()=>[s(n,null,{default:o(()=>[s(q)]),_:1}),e[27]||(e[27]=v("复制全部 ",-1))]),_:1},8,["disabled"])])]),Re((u(),_("div",_t,[h.value.length===0&&!L.value?(u(),_("div",vt,[s(n,{size:48},{default:o(()=>[s(m)]),_:1}),e[28]||(e[28]=t("p",null,"暂无日志记录",-1))])):p("",!0),(u(!0),_(E,null,O(h.value,a=>(u(),_("div",{key:a.id,class:I(["log-item",`level-${a.level.toLowerCase()}`]),onClick:A=>ne(a)},[t("div",mt,[t("span",{class:I(["log-level",a.level.toLowerCase()])},d(a.level),3),t("span",ft,d(a.timestamp),1),a.source?(u(),_("span",gt,d(a.source),1)):p("",!0),a.request_id?(u(),_("span",kt,[s(n,null,{default:o(()=>[s(he)]),_:1}),v(" "+d(a.request_id.substring(0,8)),1)])):p("",!0),a.task_id?(u(),_("span",yt,[s(n,null,{default:o(()=>[s(we)]),_:1}),v(" "+d(a.task_id.substring(0,8)),1)])):p("",!0)]),t("div",bt,d(a.message),1),a.fields&&Object.keys(a.fields).length>0?(u(),_("div",ht,[(u(!0),_(E,null,O(a.fields,(A,Q)=>(u(),_("span",{key:Q,class:"field-item"},[t("span",wt,d(Q)+":",1),t("span",Ct,d(ie(A)),1)]))),128))])):p("",!0),t("div",xt,[s(f,{text:"",size:"small",onClick:Se(A=>P(a),["stop"])},{default:o(()=>[s(n,null,{default:o(()=>[s(q)]),_:1}),e[29]||(e[29]=v("复制 ",-1))]),_:1},8,["onClick"])])],10,pt))),128))])),[[Le,L.value]]),$.value>w.value?(u(),_("div",Lt,[s(Ce,{"current-page":b.value,"onUpdate:currentPage":e[4]||(e[4]=a=>b.value=a),"page-size":w.value,"onUpdate:pageSize":e[5]||(e[5]=a=>w.value=a),"page-sizes":[50,100,200,500],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:te},null,8,["current-page","page-size","total"])])):p("",!0)]),s(xe,{modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=a=>R.value=a),title:"日志详情",width:"800px",class:"log-detail-dialog"},{footer:o(()=>[s(f,{onClick:e[6]||(e[6]=a=>P(c.value))},{default:o(()=>[s(n,null,{default:o(()=>[s(q)]),_:1}),e[40]||(e[40]=v("复制日志 ",-1))]),_:1}),s(f,{type:"primary",onClick:e[7]||(e[7]=a=>R.value=!1)},{default:o(()=>[...e[41]||(e[41]=[v("关闭",-1)])]),_:1})]),default:o(()=>[c.value?(u(),_("div",Vt,[t("div",Dt,[e[36]||(e[36]=t("h4",null,"基本信息",-1)),t("div",Ft,[t("div",$t,[e[30]||(e[30]=t("span",{class:"label"},"ID",-1)),t("span",Rt,d(c.value.id),1)]),t("div",St,[e[31]||(e[31]=t("span",{class:"label"},"级别",-1)),t("span",{class:I(["value","level-badge",c.value.level.toLowerCase()])},d(c.value.level),3)]),t("div",zt,[e[32]||(e[32]=t("span",{class:"label"},"时间",-1)),t("span",Nt,d(c.value.timestamp),1)]),t("div",jt,[e[33]||(e[33]=t("span",{class:"label"},"来源",-1)),t("span",qt,d(c.value.source||"-"),1)]),c.value.request_id?(u(),_("div",At,[e[34]||(e[34]=t("span",{class:"label"},"请求ID",-1)),t("span",Et,d(c.value.request_id),1)])):p("",!0),c.value.task_id?(u(),_("div",Ot,[e[35]||(e[35]=t("span",{class:"label"},"任务ID",-1)),t("span",It,d(c.value.task_id),1)])):p("",!0)])]),t("div",Tt,[e[37]||(e[37]=t("h4",null,"日志消息",-1)),t("div",Ut,d(c.value.message),1)]),c.value.fields&&Object.keys(c.value.fields).length>0?(u(),_("div",Bt,[e[38]||(e[38]=t("h4",null,"附加字段",-1)),t("pre",Pt,d(JSON.stringify(c.value.fields,null,2)),1)])):p("",!0),c.value.stack?(u(),_("div",Wt,[e[39]||(e[39]=t("h4",null,"堆栈跟踪",-1)),t("pre",Jt,d(c.value.stack),1)])):p("",!0)])):p("",!0)]),_:1},8,["modelValue"])])}}},Ht=Ve(Mt,[["__scopeId","data-v-115ea5fa"]]);export{Ht as default};
