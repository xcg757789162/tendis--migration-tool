import{_ as Us,o as Ns,a as Ps,b as r,c as u,d as s,e as l,w as a,f as _,t as o,h as F,g as P,F as q,p as v,n as Os,r as $,i as C,k as b,j as d,E as y,v as O,q as H,y as Ms,x as Ws}from"./index-DfwV5RE1.js";const Ys={key:0,class:"task-detail"},$s={class:"page-header"},Hs={class:"header-left"},As={class:"title-section"},Js={class:"task-id-row"},Qs={class:"header-actions"},Gs={key:0,class:"progress-overview card"},Xs={class:"overview-header"},Zs={class:"header-right"},et={class:"phase-tag"},st={class:"big-progress"},tt={class:"progress-circle"},lt={viewBox:"0 0 100 100"},at={class:"progress-text"},ot={class:"percent"},nt={class:"progress-stats"},it={class:"stat-row"},rt={class:"stat-item"},ut={class:"value stat-number"},dt={class:"stat-item"},ct={class:"value"},_t={class:"stat-item"},pt={class:"value filtered"},vt={class:"stat-row"},ft={class:"stat-item"},mt={class:"value"},yt={class:"stat-item"},gt={class:"value"},kt={class:"stat-row"},bt={class:"stat-item"},ht={class:"value highlight"},wt={class:"stat-item"},xt={class:"value"},Ct={class:"stat-item"},Vt={class:"value elapsed"},Tt={class:"info-grid"},Kt={class:"info-card card"},Ft={class:"cluster-info"},Dt={class:"info-card card"},Lt={class:"cluster-info"},Rt={class:"info-card card config-card"},St={class:"config-header"},qt={class:"config-info compact"},zt={class:"config-grid"},Et={class:"config-item"},jt={class:"value highlight"},Bt={key:0,class:"config-item"},It={class:"config-item"},Ut={class:"value"},Nt={class:"config-item"},Pt={class:"value"},Ot={class:"config-item"},Mt={class:"value"},Wt={class:"config-item"},Yt={class:"value"},$t={class:"config-item"},Ht={class:"value"},At={class:"config-item"},Jt={class:"value"},Qt={class:"config-item"},Gt={class:"value"},Xt={key:0,class:"filter-section"},Zt={class:"filter-title"},el={class:"filter-content"},sl={key:0,class:"filter-item"},tl={class:"value"},ll={key:1,class:"filter-item"},al={class:"value mono"},ol={key:2,class:"filter-item"},nl={class:"value mono warning"},il={key:3,class:"filter-item"},rl={class:"value mono"},ul={key:4,class:"filter-item no-filter"},dl={key:1,class:"filter-section no-filter-config"},cl={class:"filter-title"},_l={class:"info-card card"},pl={class:"config-info"},vl={class:"config-row"},fl={class:"value"},ml={key:0,class:"config-row"},yl={class:"value"},gl={key:1,class:"config-row"},kl={class:"value"},bl={key:2,class:"config-row"},hl={class:"value"},wl={key:3,class:"config-row"},xl={class:"value"},Cl={key:1,class:"verify-section card"},Vl={class:"mono"},Tl={key:2,class:"error-keys-section card"},Kl={class:"section-header"},Fl={class:"error-stats"},Dl={class:"stat-item"},Ll={class:"stat-value error"},Rl={class:"stat-item"},Sl={class:"stat-value warning"},ql={class:"stat-item"},zl={class:"stat-value info"},El={class:"stat-item"},jl={class:"stat-value"},Bl={key:0,class:"error-keys-list"},Il={class:"mono"},Ul={key:0,class:"list-footer"},Nl={key:1,class:"no-errors"},Pl={class:"task-logs card"},Ol={class:"logs-header"},Ml={class:"logs-actions"},Wl={key:0,class:"no-logs"},Yl={class:"log-time"},$l={class:"log-message"},Hl={key:0,class:"log-fields"},Al={key:1,class:"loading"},Jl={__name:"TaskDetail",setup(Ql){const ns=Ws(),h=O(()=>ns.params.id),i=b(null),g=b(null),z=b([]),E=b([]),j=b(""),is=b(null),D=b(1e4),M=b(!1),w=b({total:0,failed:0,skipped:0,large_keys:0}),L=b([]);let K=null;const R=b(!1),W=b(!1),f=Ms({worker_count:8,scan_batch_size:1e3,source_qps:0,target_qps:0}),rs=O(()=>{var t;if(!((t=i.value)!=null&&t.source_cluster))return{};if(typeof i.value.source_cluster=="object")return i.value.source_cluster;try{return JSON.parse(i.value.source_cluster)}catch{return typeof i.value.source_cluster=="string"?{addrs:i.value.source_cluster.split(",").map(e=>e.trim()).filter(e=>e)}:{}}}),us=O(()=>{var t;if(!((t=i.value)!=null&&t.target_cluster))return{};if(typeof i.value.target_cluster=="object")return i.value.target_cluster;try{return JSON.parse(i.value.target_cluster)}catch{return typeof i.value.target_cluster=="string"?{addrs:i.value.target_cluster.split(",").map(e=>e.trim()).filter(e=>e)}:{}}}),p=O(()=>{var t;try{return JSON.parse(((t=i.value)==null?void 0:t.config)||"{}")}catch{return{}}}),V=async()=>{try{M.value=!0;const t=await C.getTask(h.value);i.value=t,g.value=t.progress}catch(t){console.error("Fetch task failed:",t)}finally{M.value=!1}},ds=()=>{K&&(clearInterval(K),K=null),D.value>0&&(K=setInterval(()=>{var t;((t=i.value)==null?void 0:t.status)==="running"&&(V(),B())},D.value))},A=async()=>{try{const t=await C.getVerifyResults(h.value);z.value=t||[]}catch{z.value=[]}},J=async()=>{try{const t=await C.getErrorKeys(h.value);w.value=(t==null?void 0:t.stats)||{total:0,failed:0,skipped:0,large_keys:0},L.value=(t==null?void 0:t.items)||[]}catch{w.value={total:0,failed:0,skipped:0,large_keys:0},L.value=[]}},Q=async()=>{try{const t=await C.downloadErrorKeys(h.value),e=window.URL.createObjectURL(t),m=document.createElement("a");m.href=e,m.download=`error-keys-${h.value.substring(0,8)}-${H().format("YYYYMMDDHHmmss")}.csv`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(e),document.body.removeChild(m),y.success("下载成功")}catch(t){y.error("下载失败: "+(t.message||"未知错误"))}},cs=t=>({failed:"danger",skipped:"warning",large_key:"info",timeout:"danger",conflict:"warning"})[t]||"info",_s=t=>({failed:"迁移失败",skipped:"冲突跳过",large_key:"大Key",timeout:"超时",conflict:"键冲突"})[t]||t,B=async()=>{try{const t={limit:100};j.value&&(t.level=j.value);const e=await C.getTaskLogs(h.value,t);E.value=(e==null?void 0:e.items)||[]}catch(t){console.error("Fetch task logs failed:",t),E.value=[]}},G=t=>H(t).format("HH:mm:ss.SSS"),ps=t=>{if(!t||typeof t!="object")return"";const e=Object.entries(t);return e.length===0?"":e.map(([m,c])=>`${m}=${JSON.stringify(c)}`).join(" ")},vs=async()=>{try{await C.startTask(h.value),y.success("任务已启动"),V()}catch{y.error("启动失败")}},fs=async()=>{try{await C.pauseTask(h.value),y.success("任务已暂停"),V()}catch{y.error("暂停失败")}},ms=async()=>{try{await C.resumeTask(h.value),y.success("任务已恢复"),V()}catch{y.error("恢复失败")}},ys=async()=>{try{await C.triggerVerify(h.value),y.success("校验任务已触发"),setTimeout(A,3e3)}catch{y.error("触发校验失败")}},gs=t=>{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select();try{return document.execCommand("copy"),Promise.resolve()}catch(m){return Promise.reject(m)}finally{document.body.removeChild(e)}},X=async()=>{try{await gs(i.value.id),y.success("任务ID已复制")}catch{y.error("复制失败")}},ks=t=>({pending:"待启动",running:"运行中",paused:"已暂停",completed:"已完成",failed:"失败"})[t]||t,bs=t=>({skip:"跳过已存在",replace:"覆盖",error:"报错",skip_full_only:"仅全量跳过"})[t]||t||"skip",hs=t=>({prefix:"前缀匹配",pattern:"模式匹配",all:"全部迁移"})[t]||t||"全部迁移",ws=()=>{var e,m;const t=p.value||{};f.worker_count=t.worker_count||8,f.scan_batch_size=t.scan_batch_size||1e3,f.source_qps=((e=t.rate_limit)==null?void 0:e.source_qps)||0,f.target_qps=((m=t.rate_limit)==null?void 0:m.target_qps)||0,R.value=!0},xs=async()=>{W.value=!0;try{await C.updateTaskConfig(h.value,{worker_count:f.worker_count,scan_batch_size:f.scan_batch_size,rate_limit:{source_qps:f.source_qps,target_qps:f.target_qps}}),y.success("参数调整已提交，将在当前批次完成后生效"),R.value=!1,setTimeout(V,2e3)}catch(t){y.error("参数调整失败: "+(t.message||"未知错误"))}finally{W.value=!1}},Cs=t=>({full:"全量迁移",incremental:"增量同步",verify:"数据校验"})[t]||t,I=t=>t>=1e9?(t/1e9).toFixed(1)+"B":t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString(),Y=t=>t>=1099511627776?(t/1099511627776).toFixed(2)+" TB":t>=1073741824?(t/1073741824).toFixed(2)+" GB":t>=1048576?(t/1048576).toFixed(2)+" MB":t>=1024?(t/1024).toFixed(2)+" KB":t+" B",Z=t=>H(t).format("YYYY-MM-DD HH:mm:ss");return Ns(()=>{V(),A(),B(),J(),D.value>0&&(K=setInterval(()=>{var t;((t=i.value)==null?void 0:t.status)==="running"&&(V(),B(),J())},D.value))}),Ps(()=>{K&&clearInterval(K)}),(t,e)=>{var ue,de,ce,_e,pe,ve,fe,me,ye,ge,ke,be,he,we,xe,Ce,Ve,Te,Ke,Fe,De,Le,Re,Se,qe,ze,Ee,je,Be,Ie,Ue,Ne,Pe,Oe,Me,We,Ye,$e,He,Ae,Je,Qe,Ge,Xe,Ze,es,ss,ts,ls,as;const m=d("ArrowLeft"),c=d("el-icon"),k=d("el-button"),Vs=d("el-tooltip"),Ts=d("CopyDocument"),ee=d("VideoPlay"),Ks=d("VideoPause"),se=d("Checked"),T=d("el-option"),te=d("el-select"),le=d("Refresh"),ae=d("Connection"),oe=d("Link"),Fs=d("Setting"),Ds=d("Edit"),ne=d("Loading"),ie=d("Filter"),Ls=d("Clock"),x=d("el-table-column"),re=d("el-table"),Rs=d("Warning"),Ss=d("Download"),qs=d("el-tag"),zs=d("SuccessFilled"),Es=d("Document"),js=d("el-alert"),U=d("el-input-number"),N=d("el-form-item"),Bs=d("el-form"),Is=d("el-dialog");return r(),u(q,null,[i.value?(r(),u("div",Ys,[s("div",$s,[s("div",Hs,[l(k,{text:"",onClick:e[0]||(e[0]=n=>t.$router.push("/tasks"))},{default:a(()=>[l(c,null,{default:a(()=>[l(m)]),_:1}),e[9]||(e[9]=_(" 返回列表 ",-1))]),_:1}),s("div",As,[s("h1",null,o(i.value.name),1),s("div",Js,[e[10]||(e[10]=s("span",{class:"task-id-label"},"ID:",-1)),l(Vs,{content:"点击复制",placement:"top"},{default:a(()=>[s("span",{class:"task-id",onClick:X},o(i.value.id),1)]),_:1}),l(c,{class:"copy-icon",onClick:X},{default:a(()=>[l(Ts)]),_:1})])]),s("span",{class:F(["status-tag",i.value.status])},o(ks(i.value.status)),3)]),s("div",Qs,[i.value.status==="pending"?(r(),P(k,{key:0,type:"primary",onClick:vs},{default:a(()=>[l(c,null,{default:a(()=>[l(ee)]),_:1}),e[11]||(e[11]=_(" 启动任务 ",-1))]),_:1})):i.value.status==="running"?(r(),u(q,{key:1},[l(k,{onClick:fs},{default:a(()=>[l(c,null,{default:a(()=>[l(Ks)]),_:1}),e[12]||(e[12]=_(" 暂停 ",-1))]),_:1}),l(k,{type:"primary",onClick:ys},{default:a(()=>[l(c,null,{default:a(()=>[l(se)]),_:1}),e[13]||(e[13]=_(" 校验 ",-1))]),_:1})],64)):i.value.status==="paused"?(r(),P(k,{key:2,type:"primary",onClick:ms},{default:a(()=>[l(c,null,{default:a(()=>[l(ee)]),_:1}),e[14]||(e[14]=_(" 恢复 ",-1))]),_:1})):v("",!0)])]),g.value?(r(),u("div",Gs,[s("div",Xs,[e[16]||(e[16]=s("h2",null,"迁移进度",-1)),s("div",Zs,[l(te,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=n=>D.value=n),size:"small",style:{width:"120px"},onChange:ds},{default:a(()=>[l(T,{label:"手动刷新",value:0}),l(T,{label:"每 10 秒",value:1e4}),l(T,{label:"每 30 秒",value:3e4}),l(T,{label:"每 1 分钟",value:6e4})]),_:1},8,["modelValue"]),l(k,{size:"small",onClick:V,loading:M.value},{default:a(()=>[l(c,null,{default:a(()=>[l(le)]),_:1}),e[15]||(e[15]=_(" 刷新 ",-1))]),_:1},8,["loading"]),s("span",et,o(Cs(g.value.phase)),1)])]),s("div",st,[s("div",tt,[(r(),u("svg",lt,[e[17]||(e[17]=s("circle",{class:"bg",cx:"50",cy:"50",r:"45"},null,-1)),s("circle",{class:"progress",cx:"50",cy:"50",r:"45",style:Os({strokeDasharray:`${g.value.percentage*2.83} 283`})},null,4)])),s("div",at,[s("span",ot,o(((ue=g.value.percentage)==null?void 0:ue.toFixed(1))||0),1),e[18]||(e[18]=s("span",{class:"unit"},"%",-1))])]),s("div",nt,[s("div",it,[s("div",rt,[e[19]||(e[19]=s("span",{class:"label"},"已迁移Key",-1)),s("span",ut,o(I(g.value.migrated_keys||0)),1)]),s("div",dt,[e[20]||(e[20]=s("span",{class:"label"},"总Key数",-1)),s("span",ct,o(I(g.value.total_keys||0)),1)]),s("div",_t,[e[21]||(e[21]=s("span",{class:"label"},"过滤Key",-1)),s("span",pt,o(I(i.value.keys_filtered||0)),1)])]),s("div",vt,[s("div",ft,[e[22]||(e[22]=s("span",{class:"label"},"已迁移数据",-1)),s("span",mt,o(Y(g.value.migrated_bytes||0)),1)]),s("div",yt,[e[23]||(e[23]=s("span",{class:"label"},"总数据量",-1)),s("span",gt,o(Y(g.value.total_bytes||0)),1)])]),s("div",kt,[s("div",bt,[e[24]||(e[24]=s("span",{class:"label"},"当前速度",-1)),s("span",ht,o(I(g.value.current_speed||0))+" keys/s",1)]),s("div",wt,[e[25]||(e[25]=s("span",{class:"label"},"预计剩余时间",-1)),s("span",xt,o(g.value.estimated_eta||"-"),1)]),s("div",Ct,[e[26]||(e[26]=s("span",{class:"label"},"已耗时间",-1)),s("span",Vt,o(g.value.elapsed_time||"-"),1)])])])])])):v("",!0),s("div",Tt,[s("div",Kt,[s("h3",null,[l(c,null,{default:a(()=>[l(ae)]),_:1}),e[27]||(e[27]=_(" 源集群",-1))]),s("div",Ft,[(r(!0),u(q,null,$(((de=rs.value)==null?void 0:de.addrs)||[],n=>(r(),u("div",{class:"info-row",key:n},[l(c,null,{default:a(()=>[l(oe)]),_:1}),s("span",null,o(n),1)]))),128))])]),s("div",Dt,[s("h3",null,[l(c,null,{default:a(()=>[l(ae)]),_:1}),e[28]||(e[28]=_(" 目标集群",-1))]),s("div",Lt,[(r(!0),u(q,null,$(((ce=us.value)==null?void 0:ce.addrs)||[],n=>(r(),u("div",{class:"info-row",key:n},[l(c,null,{default:a(()=>[l(oe)]),_:1}),s("span",null,o(n),1)]))),128))])]),s("div",Rt,[s("div",St,[s("h3",null,[l(c,null,{default:a(()=>[l(Fs)]),_:1}),e[29]||(e[29]=_(" 运行参数",-1))]),i.value.status==="running"?(r(),P(k,{key:0,type:"primary",size:"small",onClick:ws,class:"adjust-btn"},{default:a(()=>[l(c,null,{default:a(()=>[l(Ds)]),_:1}),e[30]||(e[30]=_(" 调整参数 ",-1))]),_:1})):v("",!0)]),s("div",qt,[s("div",zt,[s("div",Et,[e[31]||(e[31]=s("span",{class:"label"},"Worker配置",-1)),s("span",jt,o(((_e=p.value)==null?void 0:_e.worker_count)||4),1)]),i.value.status==="running"?(r(),u("div",Bt,[e[32]||(e[32]=s("span",{class:"label"},"活跃Worker",-1)),s("span",{class:F(["value",{adjusting:i.value.active_workers!==(((pe=p.value)==null?void 0:pe.worker_count)||4)}])},[_(o(i.value.active_workers||((ve=p.value)==null?void 0:ve.worker_count)||4)+" ",1),i.value.active_workers!==(((fe=p.value)==null?void 0:fe.worker_count)||4)?(r(),P(c,{key:0,class:"adjusting-icon"},{default:a(()=>[l(ne)]),_:1})):v("",!0)],2)])):v("",!0),s("div",It,[e[33]||(e[33]=s("span",{class:"label"},"批次大小",-1)),s("span",Ut,o(((me=p.value)==null?void 0:me.scan_batch_size)||1e3),1)]),s("div",Nt,[e[34]||(e[34]=s("span",{class:"label"},"源端QPS",-1)),s("span",Pt,o(((ge=(ye=p.value)==null?void 0:ye.rate_limit)==null?void 0:ge.source_qps)||"不限"),1)]),s("div",Ot,[e[35]||(e[35]=s("span",{class:"label"},"目标QPS",-1)),s("span",Mt,o(((be=(ke=p.value)==null?void 0:ke.rate_limit)==null?void 0:be.target_qps)||"不限"),1)]),s("div",Wt,[e[36]||(e[36]=s("span",{class:"label"},"源端连接",-1)),s("span",Yt,o(((we=(he=p.value)==null?void 0:he.rate_limit)==null?void 0:we.source_connections)||50),1)]),s("div",$t,[e[37]||(e[37]=s("span",{class:"label"},"目标连接",-1)),s("span",Ht,o(((Ce=(xe=p.value)==null?void 0:xe.rate_limit)==null?void 0:Ce.target_connections)||50),1)]),s("div",At,[e[38]||(e[38]=s("span",{class:"label"},"冲突策略",-1)),s("span",Jt,o(bs((Ve=p.value)==null?void 0:Ve.conflict_policy)),1)]),s("div",Qt,[e[39]||(e[39]=s("span",{class:"label"},"大Key阈值",-1)),s("span",Gt,o(Y(((Te=p.value)==null?void 0:Te.large_key_threshold)||10485760)),1)])]),(Ke=p.value)!=null&&Ke.key_filter?(r(),u("div",Xt,[s("div",Zt,[l(c,null,{default:a(()=>[l(ie)]),_:1}),e[40]||(e[40]=_(" Key过滤 ",-1))]),s("div",el,[(De=(Fe=p.value)==null?void 0:Fe.key_filter)!=null&&De.mode?(r(),u("div",sl,[e[41]||(e[41]=s("span",{class:"label"},"模式:",-1)),s("span",tl,o(hs((Re=(Le=p.value)==null?void 0:Le.key_filter)==null?void 0:Re.mode)),1)])):v("",!0),(ze=(qe=(Se=p.value)==null?void 0:Se.key_filter)==null?void 0:qe.prefixes)!=null&&ze.length?(r(),u("div",ll,[e[42]||(e[42]=s("span",{class:"label"},"包含前缀:",-1)),s("span",al,o((Be=(je=(Ee=p.value)==null?void 0:Ee.key_filter)==null?void 0:je.prefixes)==null?void 0:Be.join(", ")),1)])):v("",!0),(Ne=(Ue=(Ie=p.value)==null?void 0:Ie.key_filter)==null?void 0:Ue.exclude_prefixes)!=null&&Ne.length?(r(),u("div",ol,[e[43]||(e[43]=s("span",{class:"label"},"排除前缀:",-1)),s("span",nl,o((Me=(Oe=(Pe=p.value)==null?void 0:Pe.key_filter)==null?void 0:Oe.exclude_prefixes)==null?void 0:Me.join(", ")),1)])):v("",!0),($e=(Ye=(We=p.value)==null?void 0:We.key_filter)==null?void 0:Ye.patterns)!=null&&$e.length?(r(),u("div",il,[e[44]||(e[44]=s("span",{class:"label"},"匹配模式:",-1)),s("span",rl,o((Je=(Ae=(He=p.value)==null?void 0:He.key_filter)==null?void 0:Ae.patterns)==null?void 0:Je.join(", ")),1)])):v("",!0),!((Xe=(Ge=(Qe=p.value)==null?void 0:Qe.key_filter)==null?void 0:Ge.prefixes)!=null&&Xe.length)&&!((ss=(es=(Ze=p.value)==null?void 0:Ze.key_filter)==null?void 0:es.exclude_prefixes)!=null&&ss.length)&&!((as=(ls=(ts=p.value)==null?void 0:ts.key_filter)==null?void 0:ls.patterns)!=null&&as.length)?(r(),u("div",ul,[...e[45]||(e[45]=[s("span",{class:"value"},"无过滤规则，迁移所有Key",-1)])])):v("",!0)])])):(r(),u("div",dl,[s("div",cl,[l(c,null,{default:a(()=>[l(ie)]),_:1}),e[46]||(e[46]=_(" Key过滤 ",-1))]),e[47]||(e[47]=s("div",{class:"filter-content"},[s("span",{class:"no-filter-text"},"未配置过滤规则，迁移所有Key")],-1))]))])]),s("div",_l,[s("h3",null,[l(c,null,{default:a(()=>[l(Ls)]),_:1}),e[48]||(e[48]=_(" 时间信息",-1))]),s("div",pl,[s("div",vl,[e[49]||(e[49]=s("span",{class:"label"},"创建时间",-1)),s("span",fl,o(Z(i.value.created_at)),1)]),i.value.started_at?(r(),u("div",ml,[e[50]||(e[50]=s("span",{class:"label"},"启动时间",-1)),s("span",yl,o(i.value.started_at),1)])):v("",!0),i.value.full_start_at?(r(),u("div",gl,[e[51]||(e[51]=s("span",{class:"label"},"全量开始",-1)),s("span",kl,o(i.value.full_start_at),1)])):v("",!0),i.value.incr_start_at?(r(),u("div",bl,[e[52]||(e[52]=s("span",{class:"label"},"增量开始",-1)),s("span",hl,o(i.value.incr_start_at),1)])):v("",!0),i.value.completed_at?(r(),u("div",wl,[e[53]||(e[53]=s("span",{class:"label"},"完成时间",-1)),s("span",xl,o(Z(i.value.completed_at)),1)])):v("",!0)])])]),z.value.length?(r(),u("div",Cl,[s("h3",null,[l(c,null,{default:a(()=>[l(se)]),_:1}),e[54]||(e[54]=_(" 校验结果",-1))]),l(re,{data:z.value,style:{width:"100%"}},{default:a(()=>[l(x,{label:"批次ID",width:"200"},{default:a(({row:n})=>[s("span",Vl,o(n.batch_id.slice(0,8))+"...",1)]),_:1}),l(x,{label:"采样Key数",prop:"total_keys",width:"120"}),l(x,{label:"匹配数",prop:"matched_keys",width:"100"}),l(x,{label:"不一致",width:"100"},{default:a(({row:n})=>[s("span",{class:F({"error-text":n.mismatched_keys>0})},o(n.mismatched_keys),3)]),_:1}),l(x,{label:"缺失Key",width:"100"},{default:a(({row:n})=>[s("span",{class:F({"error-text":n.missing_keys>0})},o(n.missing_keys),3)]),_:1}),l(x,{label:"一致性"},{default:a(({row:n})=>{var S;return[s("span",{class:F(["consistency-rate",{high:n.consistency_rate>=99.9}])},o(((S=n.consistency_rate)==null?void 0:S.toFixed(2))||0)+"% ",3)]}),_:1})]),_:1},8,["data"])])):v("",!0),i.value.status==="completed"||i.value.status==="failed"||w.value.total>0?(r(),u("div",Tl,[s("div",Kl,[s("h3",null,[l(c,null,{default:a(()=>[l(Rs)]),_:1}),e[55]||(e[55]=_(" 异常/跳过Key统计",-1))]),l(k,{type:"primary",size:"small",onClick:Q,disabled:w.value.total===0},{default:a(()=>[l(c,null,{default:a(()=>[l(Ss)]),_:1}),e[56]||(e[56]=_(" 下载详情 ",-1))]),_:1},8,["disabled"])]),s("div",Fl,[s("div",Dl,[s("span",Ll,o(w.value.failed||0),1),e[57]||(e[57]=s("span",{class:"stat-label"},"迁移失败",-1))]),s("div",Rl,[s("span",Sl,o(w.value.skipped||0),1),e[58]||(e[58]=s("span",{class:"stat-label"},"冲突跳过",-1))]),s("div",ql,[s("span",zl,o(w.value.large_keys||0),1),e[59]||(e[59]=s("span",{class:"stat-label"},"大Key处理",-1))]),s("div",El,[s("span",jl,o(w.value.total||0),1),e[60]||(e[60]=s("span",{class:"stat-label"},"异常总数",-1))])]),L.value.length>0?(r(),u("div",Bl,[l(re,{data:L.value,style:{width:"100%"},"max-height":"300"},{default:a(()=>[l(x,{label:"Key名称","min-width":"200"},{default:a(({row:n})=>[s("span",Il,o(n.key),1)]),_:1}),l(x,{label:"类型",width:"100",prop:"type"}),l(x,{label:"原因",width:"120"},{default:a(({row:n})=>[l(qs,{type:cs(n.reason),size:"small"},{default:a(()=>[_(o(_s(n.reason)),1)]),_:2},1032,["type"])]),_:1}),l(x,{label:"详情","min-width":"200",prop:"detail"}),l(x,{label:"时间",width:"100"},{default:a(({row:n})=>[_(o(G(n.timestamp)),1)]),_:1})]),_:1},8,["data"]),w.value.total>L.value.length?(r(),u("div",Ul,[s("span",null,"显示前 "+o(L.value.length)+" 条，共 "+o(w.value.total)+" 条",1),l(k,{text:"",type:"primary",onClick:Q},{default:a(()=>[...e[61]||(e[61]=[_("查看全部并下载",-1)])]),_:1})])):v("",!0)])):w.value.total===0?(r(),u("div",Nl,[l(c,null,{default:a(()=>[l(zs)]),_:1}),e[62]||(e[62]=s("span",null,"暂无异常Key",-1))])):v("",!0)])):v("",!0),s("div",Pl,[s("div",Ol,[s("h3",null,[l(c,null,{default:a(()=>[l(Es)]),_:1}),e[63]||(e[63]=_(" 任务日志",-1))]),s("div",Ml,[l(te,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=n=>j.value=n),placeholder:"日志级别",size:"small",style:{width:"100px"},clearable:""},{default:a(()=>[l(T,{label:"DEBUG",value:"DEBUG"}),l(T,{label:"INFO",value:"INFO"}),l(T,{label:"WARN",value:"WARN"}),l(T,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"]),l(k,{size:"small",onClick:B},{default:a(()=>[l(c,null,{default:a(()=>[l(le)]),_:1}),e[64]||(e[64]=_(" 刷新 ",-1))]),_:1})])]),s("div",{class:"logs-container",ref_key:"logsContainer",ref:is},[E.value.length===0?(r(),u("div",Wl," 暂无日志 ")):v("",!0),(r(!0),u(q,null,$(E.value,n=>{var S,os;return r(),u("div",{key:n.id,class:F(["log-entry",(S=n.level)==null?void 0:S.toLowerCase()])},[s("span",Yl,o(G(n.timestamp)),1),s("span",{class:F(["log-level",(os=n.level)==null?void 0:os.toLowerCase()])},o(n.level),3),s("span",$l,o(n.message),1),n.fields?(r(),u("span",Hl,o(ps(n.fields)),1)):v("",!0)],2)}),128))],512)])])):(r(),u("div",Al,[l(c,{class:"loading-icon"},{default:a(()=>[l(ne)]),_:1}),e[65]||(e[65]=s("span",null,"加载中...",-1))])),l(Is,{modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=n=>R.value=n),title:"调整运行参数",width:"500px"},{footer:a(()=>[l(k,{onClick:e[7]||(e[7]=n=>R.value=!1)},{default:a(()=>[...e[71]||(e[71]=[_("取消",-1)])]),_:1}),l(k,{type:"primary",onClick:xs,loading:W.value},{default:a(()=>[...e[72]||(e[72]=[_(" 应用参数 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(js,{type:"warning",closable:!1,style:{"margin-bottom":"20px"}},{title:a(()=>[...e[66]||(e[66]=[s("strong",null,"优雅调整说明",-1)])]),default:a(()=>[e[67]||(e[67]=_(" 参数调整将在当前批次完成后生效，确保正在迁移的数据完整性。调整期间任务会短暂暂停。 ",-1))]),_:1}),l(Bs,{model:f,"label-width":"120px"},{default:a(()=>[l(N,{label:"Worker数量"},{default:a(()=>[l(U,{modelValue:f.worker_count,"onUpdate:modelValue":e[3]||(e[3]=n=>f.worker_count=n),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[68]||(e[68]=s("div",{class:"form-tip"},"增加Worker可提高速度，但会增加源端负载",-1))]),_:1}),l(N,{label:"扫描批次大小"},{default:a(()=>[l(U,{modelValue:f.scan_batch_size,"onUpdate:modelValue":e[4]||(e[4]=n=>f.scan_batch_size=n),min:100,max:1e4,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(N,{label:"源端QPS限制"},{default:a(()=>[l(U,{modelValue:f.source_qps,"onUpdate:modelValue":e[5]||(e[5]=n=>f.source_qps=n),min:0,max:1e5,step:1e3,style:{width:"100%"}},null,8,["modelValue"]),e[69]||(e[69]=s("div",{class:"form-tip"},"0 表示不限制",-1))]),_:1}),l(N,{label:"目标端QPS限制"},{default:a(()=>[l(U,{modelValue:f.target_qps,"onUpdate:modelValue":e[6]||(e[6]=n=>f.target_qps=n),min:0,max:1e5,step:1e3,style:{width:"100%"}},null,8,["modelValue"]),e[70]||(e[70]=s("div",{class:"form-tip"},"0 表示不限制",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}},Xl=Us(Jl,[["__scopeId","data-v-c867d0f3"]]);export{Xl as default};
