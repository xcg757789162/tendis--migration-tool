import{_ as O,o as Q,a as W,b as r,c as p,d as o,e as a,w as l,f as _,t as d,l as B,h as X,n as Z,g as w,m as ee,i as v,j as n,k as f,p as te,q as se,E as i,s as ae,u as le}from"./index-CndybKqV.js";const oe={class:"tasks-page"},ne={class:"page-header"},re={class:"filter-bar"},ie={class:"tasks-list"},ce={class:"task-name-cell"},de={class:"name"},ue=["onClick"],pe={key:0,class:"progress-cell"},_e={class:"progress-bar"},me={class:"progress-text"},ge={key:1,class:"no-progress"},fe={key:0},ve={key:1},ke={key:0},ye={key:1},be={class:"pagination"},he={__name:"Tasks",setup(Ce){const M=le(),V=f([]),$=f(0),b=f(1),h=f(20),k=f(""),C=f("");let x=null;const F=ae(()=>{let s=V.value;return k.value&&(s=s.filter(e=>e.name.toLowerCase().includes(k.value.toLowerCase()))),s}),c=async()=>{try{const s=await v.getTasks({page:b.value,size:h.value,status:C.value});V.value=s.items||[],$.value=s.total||0}catch(s){console.error("Fetch tasks failed:",s)}},D=async s=>{try{await v.startTask(s),i.success("任务已启动"),c()}catch{i.error("启动失败")}},E=async s=>{try{await v.pauseTask(s),i.success("任务已暂停"),c()}catch{i.error("暂停失败")}},I=async s=>{try{await v.resumeTask(s),i.success("任务已恢复"),c()}catch{i.error("恢复失败")}},N=async s=>{try{await se.confirm(`确定要删除任务 "${s.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await v.deleteTask(s.id),i.success("任务已删除"),c()}catch(e){e!=="cancel"&&i.error("删除失败")}},P=s=>{M.push(`/tasks/${s.id}`)},R=s=>({pending:"待启动",running:"运行中",paused:"已暂停",completed:"已完成",failed:"失败"})[s]||s,U=({row:s})=>`row-${s.status}`,T=s=>s>=1e9?(s/1e9).toFixed(1)+"B":s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString(),Y=s=>te(s).format("YYYY-MM-DD HH:mm:ss"),j=s=>{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(s);const e=document.createElement("textarea");e.value=s,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select();try{return document.execCommand("copy"),Promise.resolve()}catch(z){return Promise.reject(z)}finally{document.body.removeChild(e)}},H=async s=>{try{await j(s),i.success("任务ID已复制")}catch{i.error("复制失败")}};return Q(()=>{c(),x=setInterval(c,1e4)}),W(()=>{x&&clearInterval(x)}),(s,e)=>{const z=n("Plus"),S=n("el-icon"),m=n("el-button"),L=n("el-input"),g=n("el-option"),q=n("el-select"),K=n("Refresh"),A=n("el-tooltip"),u=n("el-table-column"),G=n("el-table"),J=n("el-pagination");return r(),p("div",oe,[o("div",ne,[e[7]||(e[7]=o("div",null,[o("h1",null,"迁移任务"),o("p",null,"管理所有数据迁移任务")],-1)),a(m,{type:"primary",onClick:e[0]||(e[0]=t=>s.$router.push("/create"))},{default:l(()=>[a(S,null,{default:l(()=>[a(z)]),_:1}),e[6]||(e[6]=_(" 创建任务 ",-1))]),_:1})]),o("div",re,[a(L,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),placeholder:"搜索任务名称...","prefix-icon":"Search",clearable:"",style:{width:"280px"}},null,8,["modelValue"]),a(q,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),placeholder:"全部状态",clearable:"",style:{width:"140px"}},{default:l(()=>[a(g,{label:"全部",value:""}),a(g,{label:"待启动",value:"pending"}),a(g,{label:"运行中",value:"running"}),a(g,{label:"已暂停",value:"paused"}),a(g,{label:"已完成",value:"completed"}),a(g,{label:"失败",value:"failed"})]),_:1},8,["modelValue"]),a(m,{onClick:c},{default:l(()=>[a(S,null,{default:l(()=>[a(K)]),_:1}),e[8]||(e[8]=_(" 刷新 ",-1))]),_:1})]),o("div",ie,[a(G,{data:F.value,style:{width:"100%"},"row-class-name":U,onRowClick:P},{default:l(()=>[a(u,{label:"任务名称","min-width":"200"},{default:l(({row:t})=>[o("div",ce,[o("span",de,d(t.name),1),a(A,{content:t.id,placement:"top"},{default:l(()=>[o("span",{class:"id",onClick:B(y=>H(t.id),["stop"])},d(t.id),9,ue)]),_:2},1032,["content"])])]),_:1}),a(u,{label:"状态",width:"120"},{default:l(({row:t})=>[o("span",{class:X(["status-tag",t.status])},d(R(t.status)),3)]),_:1}),a(u,{label:"进度","min-width":"200"},{default:l(({row:t})=>[t.progress?(r(),p("div",pe,[o("div",_e,[o("div",{class:"progress-inner",style:Z({width:(t.progress.percentage||0)+"%"})},null,4)]),o("span",me,d((t.progress.percentage||0).toFixed(1))+"%",1)])):(r(),p("span",ge,"-"))]),_:1}),a(u,{label:"迁移数据",width:"160"},{default:l(({row:t})=>[t.progress?(r(),p("span",fe,d(T(t.progress.keys_migrated||t.progress.migrated_keys||0))+" / "+d(T(t.progress.keys_total||t.progress.total_keys||0)),1)):(r(),p("span",ve,"-"))]),_:1}),a(u,{label:"速度",width:"120"},{default:l(({row:t})=>[t.progress&&(t.progress.speed||t.progress.current_speed)?(r(),p("span",ke,d(T(t.progress.speed||t.progress.current_speed))+"/s ",1)):(r(),p("span",ye,"-"))]),_:1}),a(u,{label:"创建时间",width:"180"},{default:l(({row:t})=>[_(d(Y(t.created_at)),1)]),_:1}),a(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[o("div",{class:"actions",onClick:e[3]||(e[3]=B(()=>{},["stop"]))},[t.status==="pending"?(r(),w(m,{key:0,size:"small",type:"primary",onClick:y=>D(t.id)},{default:l(()=>[...e[9]||(e[9]=[_("启动",-1)])]),_:1},8,["onClick"])):t.status==="running"?(r(),w(m,{key:1,size:"small",onClick:y=>E(t.id)},{default:l(()=>[...e[10]||(e[10]=[_("暂停",-1)])]),_:1},8,["onClick"])):t.status==="paused"?(r(),w(m,{key:2,size:"small",type:"primary",onClick:y=>I(t.id)},{default:l(()=>[...e[11]||(e[11]=[_("恢复",-1)])]),_:1},8,["onClick"])):ee("",!0),a(m,{size:"small",type:"danger",onClick:y=>N(t)},{default:l(()=>[...e[12]||(e[12]=[_("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),o("div",be,[a(J,{"current-page":b.value,"onUpdate:currentPage":e[4]||(e[4]=t=>b.value=t),"page-size":h.value,"onUpdate:pageSize":e[5]||(e[5]=t=>h.value=t),total:$.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])])])}}},Te=O(he,[["__scopeId","data-v-181ddae2"]]);export{Te as default};
